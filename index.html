<!doctype html> <html lang=en dir=ltr> <head> <meta charset=utf-8> <title>Aurora</title> <style type="text/css">.main-menu{display:flex;flex-direction:column}.main-menu h1{font-size:40pt;margin:0;padding:0}.main-menu-options button{display:flex;flex-direction:column}.main-menu button{font-size:24pt;border:none;margin:0;padding:0}.main-menu button:hover{font-size:30pt}.main-menu button:active{color:grey}.credits h1{font-size:24pt;margin-bottom:10pt}.credits-container{display:flex;flex-direction:row}.credits-names-column{margin-right:24pt}.credits-name{font-size:20pt;margin-top:0;margin-bottom:5pt}.credits-roles{font-size:20pt;margin-top:0;margin-bottom:0}.credits button{margin-top:10pt;font-size:20pt}.world-screen-hbox,.world-screen-header{display:flex;flex-direction:row;margin:0}.world-screen-map-box{height:100%;width:100%}.map-canvas{width:100%;margin:0}.world-screen-sidebar{background-color:#000;width:20%;margin:20px;font-size:16px}.world-screen-inventory{width:20%;margin:10px;font-size:16px}.production-screen{padding-left:10pt}.production-screen-label{font-size:20pt}.production-screen-inventory{font-size:16pt;line-height:0;padding:1pt;outline:solid #fff;width:50%}.conversion-description{font-size:16pt;width:50%;text-align:left}.conversion-description-normal{color:#fff}.conversion-description-cannot-afford{color:tomato}.conversion-description-disabled{color:#ff0}.production-screen-back-button{font-size:20pt;margin-top:20pt}:root,button{background-color:#000;color:#fff;font-family:monospace}button{font-size:18px}button:focus{outline:0}button:disabled,button[disabled]{color:grey;border-color:grey}.flex-horizontal{display:flex;flex-direction:row}.flex-vertical{display:flex;flex-direction:column}.fill-horizontal{width:100%;font-family:serif}.fill-vertical{height:100%}</style></head> <body> <div id=rootdiv> <p>Loading scripts...</p> </div> <script type="text/javascript">(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var e=0;return function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,e){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(f){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+e++,f)}var e=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var e,f=[];!(e=a.next()).done;)f.push(e.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var e=function(){};e.prototype=a;return new e};
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},e={};try{return e.__proto__=a,e.a}catch(f){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,e){a.__proto__=e;if(a.__proto__!==e)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,e){a.prototype=$jscomp.objectCreate(e.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var f=$jscomp.setPrototypeOf;f(a,e)}else for(f in e)if("prototype"!=f)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(e,f);d&&Object.defineProperty(a,f,d)}else a[f]=e[f];a.superClass_=e.prototype};
$jscomp.polyfill=function(a,e,f,d){if(e){f=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var b=a[d];b in f||(f[b]={});f=f[b]}a=a[a.length-1];d=f[a];e=e(d);e!=d&&null!=e&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Math.hypot",function(a){return a?a:function(a){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var e,d,b;for(e=b=0;e<arguments.length;e++)b=Math.max(b,Math.abs(arguments[e]));if(1e+100<b||1e-100>b){if(!b)return b;for(e=d=0;e<arguments.length;e++){var p=Number(arguments[e])/b;d+=p*p}return Math.sqrt(d)*b}for(e=d=0;e<arguments.length;e++)p=Number(arguments[e]),d+=p*p;return Math.sqrt(d)}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,f,d){var b=this.length||0;0>f&&(f=Math.max(0,b+f));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(f=Number(f||0);f<d;f++)this[f]=a;return this}},"es6","es3");
$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,d={next:function(){if(f<a.length){var b=f++;return{value:e(b,a[b]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},e=Object.create(new $jscomp.global.Proxy(a,{get:function(f,d,b){return f==a&&"q"==d&&b==e}}));return!0===e.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};
$jscomp.polyfill("WeakMap",function(a){function e(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),d=Object.seal({}),e=new a([[b,2],[d,3]]);if(2!=e.get(b)||3!=e.get(d))return!1;e.delete(b);e.set(d,4);return!e.has(b)&&4==e.get(d)}catch(G){return!1}}function f(){}function d(b){var a=typeof b;return"object"===a&&null!==b||"function"===a}function b(b){if(!$jscomp.owns(b,g)){var a=new f;$jscomp.defineProperty(b,g,{value:a})}}function p(a){var e=Object[a];e&&(Object[a]=function(a){if(a instanceof
f)return a;b(a);return e(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(e())return a;var g="$jscomp_hidden_"+Math.random();p("freeze");p("preventExtensions");p("seal");var k=0,q=function(b){this.id_=(k+=Math.random()+1).toString();if(b){b=$jscomp.makeIterator(b);for(var a;!(a=b.next()).done;)a=a.value,this.set(a[0],a[1])}};q.prototype.set=function(a,e){if(!d(a))throw Error("Invalid WeakMap key");b(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+
a);a[g][this.id_]=e;return this};q.prototype.get=function(b){return d(b)&&$jscomp.owns(b,g)?b[g][this.id_]:void 0};q.prototype.has=function(b){return d(b)&&$jscomp.owns(b,g)&&$jscomp.owns(b[g],this.id_)};q.prototype.delete=function(b){return d(b)&&$jscomp.owns(b,g)&&$jscomp.owns(b[g],this.id_)?delete b[g][this.id_]:!1};return q},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function e(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),e=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=e.get(b)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var d=e.entries(),f=d.next();if(f.done||f.value[0]!=b||"s"!=f.value[1])return!1;f=d.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!d.next().done?!1:!0}catch(G){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(e())return a;$jscomp.initSymbolIterator();var f=new WeakMap,d=function(b){this.data_={};this.head_=g();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var a;!(a=b.next()).done;)a=a.value,this.set(a[0],a[1])}};d.prototype.set=function(a,e){a=0===a?0:a;var d=b(this,a);d.list||(d.list=this.data_[d.id]=[]);d.entry?d.entry.value=e:(d.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:e},d.list.push(d.entry),this.head_.previous.next=d.entry,this.head_.previous=d.entry,this.size++);return this};d.prototype.delete=function(a){a=b(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(a){return!!b(this,a).entry};
d.prototype.get=function(a){return(a=b(this,a).entry)&&a.value};d.prototype.entries=function(){return p(this,function(b){return[b.key,b.value]})};d.prototype.keys=function(){return p(this,function(b){return b.key})};d.prototype.values=function(){return p(this,function(b){return b.value})};d.prototype.forEach=function(b,a){for(var e=this.entries(),d;!(d=e.next()).done;)d=d.value,b.call(a,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var b=function(b,a){var d=a&&typeof a;"object"==
d||"function"==d?f.has(a)?d=f.get(a):(d=""+ ++k,f.set(a,d)):d="p_"+a;var e=b.data_[d];if(e&&$jscomp.owns(b.data_,d))for(b=0;b<e.length;b++){var g=e[b];if(a!==a&&g.key!==g.key||a===g.key)return{id:d,list:e,index:b,entry:g}}return{id:d,list:e,index:-1,entry:void 0}},p=function(b,a){var d=b.head_;return $jscomp.iteratorPrototype(function(){if(d){for(;d.head!=b.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:a(d)};d=null}return{done:!0,value:void 0}})},g=function(){var b={};return b.previous=
b.next=b.head=b},k=0;return d},"es6","es3");$jscomp.polyfill("Array.from",function(a){return a?a:function(a,f,d){f=null!=f?f:function(b){return b};var b=[],e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof e){a=e.call(a);for(var g=0;!(e=a.next()).done;)b.push(f.call(d,e.value,g++))}else for(e=a.length,g=0;g<e;g++)b.push(f.call(d,a[g],g));return b}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,f){return f})}},"es8","es3");
(function(a){function e(d){if(f[d])return f[d].exports;var b=f[d]={i:d,l:!1,exports:{}};a[d].call(b.exports,b,b.exports,e);b.l=!0;return b.exports}var f={};e.m=a;e.c=f;e.d=function(a,b,f){e.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:f})};e.r=function(a){$jscomp.initSymbol();$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};e.t=function(a,
b){b&1&&(a=e(a));if(b&8||b&4&&"object"===typeof a&&a&&a.__esModule)return a;var d=Object.create(null);e.r(d);Object.defineProperty(d,"default",{enumerable:!0,value:a});if(b&2&&"string"!=typeof a)for(var f in a)e.d(d,f,function(b){return a[b]}.bind(null,f));return d};e.n=function(a){var b=a&&a.__esModule?function(){return a["default"]}:function(){return a};e.d(b,"a",b);return b};e.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};e.p="";return e(e.s=1)})([,function(a,e,f){function d(c,
h,a){return Math.max(Math.min(h,a),c)}f.r(e);var b=function(){};b.makeDiv=function(c){var h=document.createElement("div");c&&h.classList.add.apply(h.classList,$jscomp.arrayFromIterable(c));return h};b.makeDivContaining=function(c,h){h=this.makeDiv(h);c=$jscomp.makeIterator(c);for(var a=c.next();!a.done;a=c.next())h.appendChild(a.value);return h};b.makeElement=function(c,h,a){c=document.createElement(c);c.innerText=h;a&&c.classList.add.apply(c.classList,$jscomp.arrayFromIterable(a));return c};b.makePara=
function(c,h){return b.makeElement("p",c,h)};b.makeHeader=function(c,h,a){return b.makeElement("h"+(void 0===h?1:h),c,a)};b.makeButton=function(c,h,a,b){b=void 0===b?!1:b;var B=document.createElement("button");B.type="button";B.disabled=b;B.innerText=c;a&&B.classList.add.apply(B.classList,$jscomp.arrayFromIterable(a));B.onclick=function(c){c.preventDefault;h.call(this,c)};return B};b.makeImg=function(c,h){var a=document.createElement("img");a.src=c;h&&a.classList.add.apply(a.classList,$jscomp.arrayFromIterable(h));
return a};b.makeCanvas=function(c,h,a){var b=document.createElement("canvas");b.width=c;b.height=h;a&&b.classList.add.apply(b.classList,$jscomp.arrayFromIterable(a));return b};b.fillHTML=function(c,h){c.innerHTML="";h=$jscomp.makeIterator(h);for(var a=h.next();!a.done;a=h.next())c.appendChild(a.value)};var p=function(){};p.renderMainMenu=function(){return b.makeDivContaining([b.makeHeader("Aurora",1),b.makeDivContaining([b.makeButton("start_game",function(){return n.startGame()}),b.makeButton("display_credits",
function(){return n.showCredits()})],["main-menu-options"])],["main-menu"])};var g=function(c,h){this.x=c;this.y=h};g.prototype.toString=function(){return"("+this.x+", "+this.y+")"};g.prototype.distanceFrom=function(c){return Math.hypot(Math.abs(this.x-c.x),Math.abs(this.y-c.y))};var k=function(c,h){var a=this;this.viewWidth=12;this.viewHeight=8;this.viewPosition=new g(0,0);this.highlightedCoordinates=null;this.world=h;this.parentScreen=c;this.worldCanvas=b.makeCanvas(this.world.width*k.pixelsPerTile,
this.world.height*k.pixelsPerTile);c=this.worldCanvas.getContext("2d");c.beginPath();c.rect(0,0,this.worldCanvas.width,this.worldCanvas.height);c.fillStyle="black";c.fill();this.viewCanvas=b.makeCanvas(this.viewWidth*k.pixelsPerTile,this.viewHeight*k.pixelsPerTile,["map-canvas"]);this.viewCanvas.addEventListener("click",function(c){return a.handleClick(c)});this.refreshViewableArea()};k.prototype.getViewCanvas=function(){return this.viewCanvas};k.prototype.updateViewCanvas=function(){var c=this.viewCanvas.getContext("2d"),
a=this.viewWidth*k.pixelsPerTile,b=this.viewHeight*k.pixelsPerTile;c.drawImage(this.worldCanvas,this.viewPosition.x*k.pixelsPerTile,this.viewPosition.y*k.pixelsPerTile,a,b,0,0,a,b)};k.prototype.refreshViewableArea=function(){var c=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,this.viewHeight);c=$jscomp.makeIterator(c);for(var a=c.next();!a.done;a=c.next())this.rerenderTile(a.value)};k.prototype.drawImageAtCoordinates=function(c,a){var h=this,b=this.worldCanvas.getContext("2d");
b.imageSmoothingEnabled=!1;var d=new Image;d.onload=function(){b.drawImage(d,a.x*k.pixelsPerTile,a.y*k.pixelsPerTile,k.pixelsPerTile,k.pixelsPerTile);h.updateViewCanvas()};d.src=c};k.prototype.rerenderTile=function(c){this.drawImageAtCoordinates(c.getImgSrc(),c.position);c.position===this.highlightedCoordinates&&this.drawImageAtCoordinates("assets/ui/highlight.png",c.position)};k.prototype.selectTile=function(c){if(this.highlightedCoordinates){var a=this.world.getTileAtCoordinates(this.highlightedCoordinates);
this.highlightedCoordinates=null;this.rerenderTile(a)}c?(this.drawImageAtCoordinates("assets/ui/highlight.png",c.position),this.highlightedCoordinates=c.position):this.highlightedCoordinates=null;this.parentScreen.changeSidebarTile(this.highlightedCoordinates)};k.prototype.moveViewArea=function(c,a){var b=this.viewPosition.x,h=this.viewPosition.y;c=d(0,this.viewPosition.x+c,this.world.width-this.viewWidth);a=d(0,this.viewPosition.y+a,this.world.height-this.viewHeight);this.viewPosition=new g(c,a);
c=this.viewPosition.x-b;a=this.viewPosition.y-h;if(0<c)for(b=this.world.getTilesInRectangle(this.viewPosition.x+this.viewWidth-c,this.viewPosition.y,c,this.viewHeight),h=$jscomp.makeIterator(b),b=h.next();!b.done;b=h.next())this.rerenderTile(b.value);if(0>c)for(c=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,-1*c,this.viewHeight),c=$jscomp.makeIterator(c),b=c.next();!b.done;b=c.next())this.rerenderTile(b.value);if(0<a)for(c=this.world.getTilesInRectangle(this.viewPosition.x,
this.viewPosition.y+this.viewHeight-a,this.viewWidth,a),c=$jscomp.makeIterator(c),b=c.next();!b.done;b=c.next())this.rerenderTile(b.value);if(0>a)for(a=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,-1*a),a=$jscomp.makeIterator(a),b=a.next();!b.done;b=a.next())this.rerenderTile(b.value)};k.prototype.handleClick=function(c){c=this.world.getTileAtCoordinates(new g(Math.floor(this.viewWidth/this.viewCanvas.clientWidth*(c.pageX-this.viewCanvas.offsetLeft))+this.viewPosition.x,
Math.floor(this.viewHeight/this.viewCanvas.clientHeight*(c.pageY-this.viewCanvas.offsetTop))+this.viewPosition.y));this.selectTile(c)};k.prototype.handleKeyDown=function(c){c=c.code;"ArrowUp"!==c&&"KeyW"!==c||this.moveViewArea(0,-1);"ArrowLeft"!==c&&"KeyA"!==c||this.moveViewArea(-1,0);"ArrowDown"!==c&&"KeyS"!==c||this.moveViewArea(0,1);"ArrowRight"!==c&&"KeyD"!==c||this.moveViewArea(1,0)};k.pixelsPerTile=64;var q=function(c,a){this.parentScreen=c;this.run=a;this.position=null;this.html=b.makeDiv(["world-screen-sidebar"]);
this.refresh()};q.prototype.getHTML=function(){return this.html};q.prototype.changeTile=function(c){this.position=c;this.refresh()};q.prototype.refresh=function(){if(null==this.position)b.fillHTML(this.html,[b.makePara("No structure or terrain tile selected")]);else{var c=this.run.world.getTileAtCoordinates(this.position),a=b.makeDiv();c.populationCapacity&&a.appendChild(b.makePara("Population capacity for "+c.populationCapacity.capacity+" "+c.populationCapacity.species.name));var d=b.makeDiv();if(0<
c.possibleProjects.length){d.appendChild(b.makePara("Projects:"));for(var e=$jscomp.makeIterator(c.possibleProjects),f=e.next();!f.done;f=e.next())d.appendChild(this.makeProjectHTML(c,f.value))}e=b.makeDiv();if(0<c.resourceConversions.length){e.appendChild(b.makePara("Production:"));f=$jscomp.makeIterator(c.resourceConversions);for(var g=f.next();!g.done;g=f.next())e.appendChild(this.makeConversionHTML(g.value))}b.fillHTML(this.html,[b.makePara(c.getTileName()),b.makePara("Coordinates: "+this.position.x+
", "+this.position.y),a,d,e])}};q.prototype.makeProjectHTML=function(c,a){var h=this,d=b.makeDiv(),e=!a.canDo(c.position,this.run);e=b.makeButton(a.title,function(){h.doProject(a,c)},[],e);d.appendChild(e);0==a.costs.length?d.appendChild(b.makePara("Cost: Free")):(e="Cost: "+a.costs.map(function(c){return""+c.toString()}).join(", "),d.appendChild(b.makePara(e)));0<a.completionRequirements.length&&(e=a.completionRequirements.map(function(c){return"- "+c.toString()+"\n"}).join(""),d.appendChild(b.makePara("Requirements:\n"+
e)));return d};q.prototype.makeConversionHTML=function(c){return b.makePara("- "+c.toString())};q.prototype.doProject=function(c,a){c.doAction(a.position,this.run);this.parentScreen.refreshComponents()};var M=function(c){this.inventory=c.inventory;this.html=b.makeDiv(["world-screen-inventory"]);this.refresh()};M.prototype.getHTML=function(){return this.html};M.prototype.refresh=function(){for(var c=b.makeHeader("Population: "+this.inventory.getTotalPopulation(),1),a=b.makePara("Available workers: "+
this.inventory.getAvailableWorkers()),e=b.makeDiv(),d=$jscomp.makeIterator(this.inventory.getPopulationStrings()),f=d.next();!f.done;f=d.next())e.appendChild(b.makePara(f.value));d=b.makeDiv();var g=$jscomp.makeIterator(this.inventory.getInventoryStrings());for(f=g.next();!f.done;f=g.next())d.appendChild(b.makePara(f.value));b.fillHTML(this.html,[b.makeDivContaining([c,a,e,b.makeHeader("Inventory:",1),d])])};var N=function(c){this.html=b.makeDiv(["world-screen-header"]);this.run=c;this.refresh()};
N.prototype.refresh=function(){var c=b.makeButton("Quit Game",function(){n.showMainMenu()}),a=b.makeButton("Next Turn",function(){n.transitionToNextTurn()}),d=b.makeButton("Manage Production",function(){n.showProductionScreen()});b.fillHTML(this.html,[c,d,a])};N.prototype.getHTML=function(){return this.html};var I=function(c){this.mapUI=new k(this,c.world);this.tileSidebar=new q(this,c);var a=this.mapUI.getViewCanvas();this.inventorySidebar=new M(c);var d=this.tileSidebar.getHTML(),e=this.inventorySidebar.getHTML();
this.header=new N(c);this.worldScreenHTML=b.makeDivContaining([this.header.getHTML(),b.makeDivContaining([e,b.makeDivContaining([a],["world-screen-map-box"]),d],["world-screen-hbox"])],["flex-vertical"])};I.prototype.getHTML=function(){return this.worldScreenHTML};I.prototype.refreshComponents=function(){this.mapUI.refreshViewableArea();this.tileSidebar.refresh();this.inventorySidebar.refresh();this.header.refresh()};I.prototype.handleKeyDown=function(c){this.mapUI.handleKeyDown(c)};I.prototype.changeSidebarTile=
function(c){this.tileSidebar.changeTile(c)};var G=function(){};G.generate=function(c,a){for(var b=Array(c),h=0;h<c;h++)b[h]=a();return b};G.flatten=function(c){return c.reduce(function(c,a){c=void 0===c?[]:c;return c.concat(a)})};var u=function(c){this.position=c;this.possibleProjects=[];this.resourceConversions=[];this.populationCapacity=void 0},H=function(c,a,b,d){this.title=c;this.action=a;this.costs=b;this.completionRequirements=d};H.prototype.canDo=function(c,a){return a.inventory.canAfford(this.costs)&&
this.completionRequirements.every(function(b){return b.evaluate(a,c)})};H.prototype.doAction=function(c,a){if(!this.canDo(c,a))throw"tried to do project "+this.title+" without meeting requirments";a.inventory.payCost(this.costs);this.action(c,a)};var w=function(c,a){this.name=c;this.growthMultiplier=a};w.values=function(){return Object.keys(w).map(function(c){return w[c]})};w.Human=new w("Human Colonists",.1);w.Robot=new w("Robotic Platform",1);var S=function(c,a){this.species=c;this.capacity=a},
x=function(c){c=u.call(this,c)||this;c.populationCapacity=new S(w.Human,200);return c};$jscomp.inherits(x,u);x.prototype.getImgSrc=function(){return"assets/tiles/habitat.png"};x.prototype.getTileName=function(){return x.tileName};x.tileName="Habitat Dome";var t=function(c,a){this.resource=c;this.quantity=a};t.prototype.toString=function(){return this.resource.name+" x"+this.quantity};var l=function(c){this.name=c};l.values=function(){return Object.keys(l).map(function(c){return l[c]})};l.Energy=new l("Energy");
l.Metal=new l("Metal Ore");l.BuildingMaterials=new l("Construction Materials");l.Electronics=new l("Electronics");var J=function(c,a){this.radius=c;this.targetType=a;return this};$jscomp.inherits(J,function(){});J.prototype.evaluate=function(c,a){var b=this;return 0<c.world.getTilesInCircle(a,this.radius).filter(function(c){return c instanceof b.targetType}).length};J.prototype.toString=function(){return 1==this.radius?"adjacent to a "+this.targetType.tileName:"within "+this.radius+" units of a "+
this.targetType.tileName};var y=function(c,a,b){this.inputs=c;this.outputs=a;this.enabled=!0;this.requiredWorkers=b||0;this.isFree()?this.priority=0:(this.priority=y.nextNumber,y.nextNumber++)};y.prototype.toString=function(){var c=this.outputs.map(function(c){return c.toString()}).join(", "),a="Produce "+c;0<this.inputs.length&&(a="Convert "+this.inputs.map(function(c){return c.toString()}).join(", ")+" into "+c);0!=this.requiredWorkers&&(a+=" using "+this.requiredWorkers+" workers");return a};y.prototype.isFree=
function(){return 0==this.inputs.length&&!this.requiredWorkers};y.nextNumber=1;var C=function(c){c=u.call(this,c)||this;c.resourceConversions=[new y([new t(l.Metal,100)],[new t(l.BuildingMaterials,100)],60),new y([new t(l.Metal,100)],[new t(l.Electronics,100)],30)];return c};$jscomp.inherits(C,u);C.prototype.getImgSrc=function(){return"assets/tiles/mining_facility.png"};C.prototype.getTileName=function(){return C.tileName};C.tileName="Ore Processing Center";var z=function(c){c=u.call(this,c)||this;
c.possibleProjects=[new H("Strip Mining",function(c,a){a.inventory.addResource(l.Metal,150);a.world.placeTile(new r(c))},[new t(l.Energy,25)],[])];return c};$jscomp.inherits(z,u);z.prototype.getImgSrc=function(){return"assets/tiles/mountain.png"};z.prototype.getTileName=function(){return z.tileName};z.tileName="Mountain";var D=function(c){c=u.call(this,c)||this;c.resourceConversions=[new y([],[new t(l.Energy,100)])];return c};$jscomp.inherits(D,u);D.prototype.getImgSrc=function(){return"assets/tiles/solar_panels.png"};
D.prototype.getTileName=function(){return D.tileName};D.tileName="Photovoltaic Array";var r=function(c){c=u.call(this,c)||this;c.possibleProjects=[new H("Construct habitat dome",function(c,a){a.world.placeTile(new x(c))},[new t(l.BuildingMaterials,100)],[new J(1,x)]),new H("Construct ore processing center",function(c,a){a.world.placeTile(new C(c))},[new t(l.Energy,200),new t(l.Metal,300)],[new J(5,z)]),new H("Construct photovoltaic array",function(c,a){a.world.placeTile(new D(c))},[new t(l.Electronics,
200)],[])];return c};$jscomp.inherits(r,u);r.prototype.getImgSrc=function(){return"assets/tiles/wasteland.png"};r.prototype.getTileName=function(){return r.tileName};r.tileName="Wasteland";var E=function(){};E.realBetween=function(c,a){return Math.random()*(a-c)+c};E.intBetween=function(c,a){return Math.floor(E.realBetween(c,a))};E.fromArray=function(c){return c[E.intBetween(0,c.length)]};var F=function(c){this.width=c.worldWidth;this.height=c.worldHeight;this.grid=Array(this.height);for(var a=0;a<
this.height;a++){this.grid[a]=Array(this.width);for(var b=0;b<this.width;b++)this.grid[a][b]=new r(new g(b,a))}a=$jscomp.makeIterator(c.nonrandomTiles);for(b=a.next();!b.done;b=a.next())this.placeTile(b.value);c=E.intBetween(c.minMountains,c.maxMountains);for(a=0;a<c;a++)b=this.getTiles().filter(function(c){return c instanceof r}),b=E.fromArray(b).position,this.placeTile(new z(b))};F.prototype.placeTile=function(c){this.grid[c.position.y][c.position.x]=c};F.prototype.getTiles=function(){return G.flatten(this.grid)};
F.prototype.getTilesInRectangle=function(c,a,b,d){0>a&&(a=0);0>c&&(c=0);var h=[];a=this.grid.slice(a,a+d);a=$jscomp.makeIterator(a);for(d=a.next();!d.done;d=a.next()){d=d.value.slice(c,c+b);d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())h.push(e.value)}return h};F.prototype.getTileAtCoordinates=function(c){return this.grid[c.y][c.x]};F.prototype.getTilesInCircle=function(c,a){return this.getTiles().filter(function(b){return c.distanceFrom(b.position)<=a})};F.prototype.getPopulationCapacity=
function(c){for(var a=0,b=$jscomp.makeIterator(this.getTiles()),d=b.next();!d.done;d=b.next())d=d.value,d.populationCapacity&&d.populationCapacity.species==c&&(a+=d.populationCapacity.capacity);return a};var v=function(){this.map=new Map([])};v.prototype.add=function(c,a){this.set(c,this.get(c)+a)};v.prototype.remove=function(c,a){this.add(c,-1*a)};v.prototype.get=function(c){return this.map.get(c)||0};v.prototype.set=function(c,a){if(0>a)throw"tried to set quantity to negative value";0==a?this.map.delete(c):
this.map.set(c,a)};v.prototype.getSum=function(){return Array.from(this.map.values()).reduce(function(c,a){return c+a},0)};v.prototype.positiveQuantityKeys=function(){return Array.from(this.map.keys())};v.prototype.clone=function(){for(var c=new v,a=$jscomp.makeIterator(this.positiveQuantityKeys()),b=a.next();!b.done;b=a.next())b=b.value,c.add(b,this.get(b));return c};var m=function(a){this.world=a;this.resourceQuantities=new v;this.populationQuantities=new v;this.availableWorkers=0};m.prototype.addResource=
function(a,b){this.resourceQuantities.add(a,b)};m.prototype.removeResource=function(a,b){this.resourceQuantities.remove(a,b)};m.prototype.getResourceQuantity=function(a){return this.resourceQuantities.get(a)||0};m.prototype.addWorkers=function(a,b){this.populationQuantities.add(a,b);this.populationQuantities.set(a,d(0,this.populationQuantities.get(a),this.world.getPopulationCapacity(a)))};m.prototype.releaseWorkers=function(){this.availableWorkers=this.populationQuantities.getSum()};m.prototype.occupyWorkers=
function(a){if(this.availableWorkers<a)throw"insufficient workers";if(0>a)throw"tried to occupy a negative number of workers";this.availableWorkers-=a};m.prototype.doPopulationGrowth=function(){for(var a=$jscomp.makeIterator(this.populationQuantities.positiveQuantityKeys()),b=a.next();!b.done;b=a.next()){b=b.value;var d=Math.floor(b.growthMultiplier*this.populationQuantities.get(b));this.addWorkers(b,d)}};m.prototype.getTotalPopulation=function(){return this.populationQuantities.getSum()};m.prototype.getAvailableWorkers=
function(){return this.availableWorkers};m.prototype.canAfford=function(a){var c=this,b=new Map;a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())d=d.value,b.set(d.resource,d.quantity+(b.get(d.resource)||0));return Array.from(b.keys()).every(function(a){var d=b.get(a);a=c.getResourceQuantity(a);return d<=a})};m.prototype.hasEnoughWorkers=function(a){return this.availableWorkers>a};m.prototype.payCost=function(a){if(this.canAfford(a)){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=
a.next())c=c.value,this.removeResource(c.resource,c.quantity)}else throw"Cannot afford to pay cost";};m.prototype.getResourceList=function(){return this.resourceQuantities.positiveQuantityKeys()};m.prototype.getInventoryStrings=function(){var a=this;return this.getResourceList().map(function(c){return c.name+": "+a.getResourceQuantity(c)})};m.prototype.getPopulationStrings=function(){var a=this;return this.populationQuantities.positiveQuantityKeys().map(function(c){return a.populationQuantities.get(c)+
" "+c.name})};m.prototype.applyConversions=function(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())if(c=c.value,this.canAfford(c.inputs)&&this.hasEnoughWorkers(c.requiredWorkers)&&c.enabled){this.payCost(c.inputs);this.occupyWorkers(c.requiredWorkers);c=$jscomp.makeIterator(c.outputs);for(var b=c.next();!b.done;b=c.next())b=b.value,this.addResource(b.resource,b.quantity)}};m.prototype.clone=function(){var a=new m(this.world);a.resourceQuantities=this.resourceQuantities.clone();
a.populationQuantities=this.populationQuantities.clone();a.availableWorkers=this.availableWorkers;return a};var O=function(a,b,d,e,f){this.nonrandomTiles=a;this.worldWidth=b;this.worldHeight=d;this.minMountains=e;this.maxMountains=f};O.standardWorldParameters=function(){var a=[new r(new g(0,0)),new z(new g(1,0)),new r(new g(2,0)),new r(new g(0,1)),new C(new g(1,1)),new r(new g(2,1)),new D(new g(0,2)),new x(new g(1,2)),new r(new g(2,2))];return new O(a,20,20,20,25)};var K=function(){this.turnNumber=
1;this.world=new F(O.standardWorldParameters());this.inventory=new m(this.world);this.inventory.addWorkers(w.Human,100);this.inventory.releaseWorkers()};K.prototype.getResourceConversions=function(){var a=G.flatten(this.world.getTiles().map(function(a){return a.resourceConversions}));a.sort(function(a,c){return a.priority-c.priority});return a};K.prototype.completeTurn=function(){this.inventory.applyConversions(this.getResourceConversions());this.inventory.releaseWorkers();this.inventory.doPopulationGrowth();
this.turnNumber++};K.prototype.increaseConversionPriority=function(a){if(0!=a.priority){var c=this.getResourceConversions(),b=c.indexOf(a);-1!=b&&0!=b&&(c=c[b-1],0!=c.priority&&(b=$jscomp.makeIterator([c.priority,a.priority]),a.priority=b.next().value,c.priority=b.next().value))}};K.prototype.decreaseConversionPriority=function(a){if(0!=a.priority){var c=this.getResourceConversions(),b=c.indexOf(a);-1!=b&&b!=c.length-1&&(c=c[b+1],b=$jscomp.makeIterator([c.priority,a.priority]),a.priority=b.next().value,
c.priority=b.next().value)}};var P=function(a,b){this.currentGame=a;this.worldScreen=b};P.prototype.addResource=function(a,b){this.currentGame.inventory.addResource(a,b);this.worldScreen.refreshComponents()};var L=function(){this.html=b.makeDiv();b.fillHTML(this.html,[b.makePara("Loading...")])};L.prototype.getHTML=function(){return this.html};L.prototype.revealButton=function(){b.fillHTML(this.html,[b.makeButton("Continue",this.continueToNextTurn)])};L.prototype.continueToNextTurn=function(){n.showWorldScreen()};
var A=function(a){this.run=a;this.html=b.makeDiv(["production-screen"]);this.refresh()};A.prototype.refresh=function(){var a=this,d=this.run.inventory.clone(),e=this.run.getResourceConversions().filter(function(a){return a.isFree()}),f=e.map(function(c){return a.renderConversion(c,!0,!1)});d.applyConversions(e);var g=this.run.getResourceConversions().filter(function(a){return!a.isFree()});e=[];g=$jscomp.makeIterator(g);for(var k=g.next();!k.done;k=g.next())k=k.value,d.canAfford(k.inputs)&&d.hasEnoughWorkers(k.requiredWorkers)?
(e.push(this.renderConversion(k,!0,!0)),d.applyConversions([k])):e.push(this.renderConversion(k,!1,!0));b.fillHTML(this.html,[b.makePara("Resource Production Report",["production-screen-label"]),b.makePara("Available workers at start of next production cycle: "+this.run.inventory.getAvailableWorkers(),["production-screen-label"]),b.makePara("Resources available at start of next production cycle:",["production-screen-label"]),this.renderInventory(this.run.inventory),b.makePara("Resource generation in next production cycle:",
["production-screen-label"]),b.makeDivContaining(f),b.makePara("Resource conversion in next production cycle:",["production-screen-label"]),b.makeDivContaining(e),b.makePara("Unused workers at end of next production cycle: "+d.getAvailableWorkers(),["production-screen-label"]),b.makePara("Resources available at end of next production cycle:",["production-screen-label"]),this.renderInventory(d),b.makeButton("Back",function(){n.showWorldScreen()},["production-screen-back-button"])])};A.prototype.getHTML=
function(){return this.html};A.prototype.renderInventory=function(a){a=a.getInventoryStrings().map(function(a){return b.makePara(a)});0==a.length&&a.push(b.makePara("(none)"));return b.makeDivContaining(a,["production-screen-inventory"])};A.prototype.renderConversion=function(a,d,e){var c=this,f=b.makeDiv(["flex-horizontal"]),h=a.toString(),g="conversion-description-normal";a.enabled?d||(h="(cannot afford) "+a.toString(),g="conversion-description-cannot-afford"):(h="(disabled) "+a.toString(),g="conversion-description-disabled");
f.appendChild(b.makeButton(h,function(){c.toggle(a)},[g,"conversion-description"]));e&&(f.appendChild(b.makeButton("Move Up",function(){return c.moveConversionUp(a)})),f.appendChild(b.makeButton("Move Down",function(){return c.moveConversionDown(a)})));return f};A.prototype.moveConversionUp=function(a){this.run.increaseConversionPriority(a);this.refresh()};A.prototype.moveConversionDown=function(a){this.run.decreaseConversionPriority(a);this.refresh()};A.prototype.toggle=function(a){a.enabled=!a.enabled;
this.refresh()};a=function(a,b){this.name=a;this.roles=b};var Q=[new a("Grace Rarer",["Team Lead","Gameplay Programmer"]),new a("Prindle",["Tooling Programmer"])],R=function(){};R.render=function(){var a=Q.map(function(a){return b.makePara(a.name,["credits-name"])}),d=Q.map(function(a){return b.makePara(a.roles.join(", "),["credits-roles"])});return b.makeDivContaining([b.makeHeader("Credits",1),b.makeDivContaining([b.makeDivContaining(a,["credits-names-column"]),b.makeDivContaining(d)],["credits-container"]),
b.makeButton("Back",function(){return n.showMainMenu()})],["credits"])};var n=function(){};n.showMainMenu=function(){this.disableCheats();b.fillHTML(this.rootDiv,[p.renderMainMenu()])};n.showCredits=function(){this.disableCheats();b.fillHTML(this.rootDiv,[R.render()])};n.startGame=function(){this.currentRun=new K;this.showWorldScreen()};n.showWorldScreen=function(){var a=new I(this.currentRun);b.fillHTML(this.rootDiv,[a.getHTML()]);this.enableCheats(a);document.onkeydown=function(b){a.handleKeyDown(b)}};
n.showProductionScreen=function(){this.disableCheats();var a=new A(this.currentRun);b.fillHTML(this.rootDiv,[a.getHTML()])};n.transitionToNextTurn=function(){this.disableCheats();var a=new L;b.fillHTML(this.rootDiv,[a.getHTML()]);this.currentRun.completeTurn();a.revealButton()};n.enableCheats=function(a){window.cheats=new P(this.currentRun,a);window.Resources=l};n.disableCheats=function(){window.cheats=void 0;window.Resources=void 0};n.rootDiv=document.getElementById("rootdiv");window.onload=function(){console.log("Script Loaded");
n.showMainMenu()}}]);}).call(this || window)
</script><script type="text/javascript">(function(){'use strict';}).call(this || window)
</script></body> </html> 