<!doctype html> <html lang=en dir=ltr> <head> <meta charset=utf-8> <title>Aurora</title> <style type="text/css">.world-screen-hbox,.world-screen-header{display:flex;flex-direction:row;margin:0}.world-screen-map-box{height:100%;width:100%}.map-canvas{width:100%;margin:0}.world-screen-sidebar{background-color:#000;width:20%;margin:20px;font-size:16px}.world-screen-inventory{width:20%;margin:10px;font-size:16px}.production-screen{padding-left:10pt}.production-screen-label{font-size:20pt}.production-screen-inventory{font-size:16pt;line-height:0;padding:1pt;outline:solid #fff;width:50%}.conversion-description{font-size:16pt;width:50%;text-align:left}.conversion-description-normal{color:#fff}.conversion-description-cannot-afford{color:tomato}.conversion-description-disabled{color:#ff0}.production-screen-back-button{font-size:20pt;margin-top:20pt}:root,button{background-color:#000;color:#fff;font-family:monospace}button{font-size:18px}button:disabled,button[disabled]{color:grey;border-color:grey}.flex-horizontal{display:flex;flex-direction:row}.flex-vertical{display:flex;flex-direction:column}.fill-horizontal{width:100%;font-family:serif}.fill-vertical{height:100%}</style></head> <body> <div id=rootdiv> <p>Loading scripts...</p> </div> <script type="text/javascript">(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var c=0;return function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(b,c){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function b(d){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(d||"")+"_"+c++,d)}var c=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.makeIterator=function(b){var c="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return c?c.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var c,d=[];!(c=b.next()).done;)d.push(c.value);return d};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var c=function(){};c.prototype=b;return new c};
$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},c={};try{return c.__proto__=b,c.a}catch(d){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,c){b.__proto__=c;if(b.__proto__!==c)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,c){b.prototype=$jscomp.objectCreate(c.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var d=$jscomp.setPrototypeOf;d(b,c)}else for(d in c)if("prototype"!=d)if(Object.defineProperties){var a=Object.getOwnPropertyDescriptor(c,d);a&&Object.defineProperty(b,d,a)}else b[d]=c[d];b.superClass_=c.prototype};
$jscomp.polyfill=function(b,c,d,a){if(c){d=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var f=b[a];f in d||(d[f]={});d=d[f]}b=b[b.length-1];a=d[b];c=c(a);c!=a&&null!=c&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Math.hypot",function(b){return b?b:function(b){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var c,a,f;for(c=f=0;c<arguments.length;c++)f=Math.max(f,Math.abs(arguments[c]));if(1e+100<f||1e-100>f){if(!f)return f;for(c=a=0;c<arguments.length;c++){var h=Number(arguments[c])/f;a+=h*h}return Math.sqrt(a)*f}for(c=a=0;c<arguments.length;c++)h=Number(arguments[c]),a+=h*h;return Math.sqrt(a)}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,d,a){var c=this.length||0;0>d&&(d=Math.max(0,c+d));if(null==a||a>c)a=c;a=Number(a);0>a&&(a=Math.max(0,c+a));for(d=Number(d||0);d<a;d++)this[d]=b;return this}},"es6","es3");
$jscomp.iteratorFromArray=function(b,c){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var d=0,a={next:function(){if(d<b.length){var f=d++;return{value:c(f,b[f]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var b={},c=Object.create(new $jscomp.global.Proxy(b,{get:function(d,a,f){return d==b&&"q"==a&&f==c}}));return!0===c.q}catch(d){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(b,c){return Object.prototype.hasOwnProperty.call(b,c)};
$jscomp.polyfill("WeakMap",function(b){function c(){if(!b||!Object.seal)return!1;try{var a=Object.seal({}),c=Object.seal({}),m=new b([[a,2],[c,3]]);if(2!=m.get(a)||3!=m.get(c))return!1;m.delete(a);m.set(c,4);return!m.has(a)&&4==m.get(c)}catch(u){return!1}}function d(){}function a(a){var b=typeof a;return"object"===b&&null!==a||"function"===b}function f(a){if(!$jscomp.owns(a,g)){var b=new d;$jscomp.defineProperty(a,g,{value:b})}}function h(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof
d)return a;f(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(c())return b;var g="$jscomp_hidden_"+Math.random();h("freeze");h("preventExtensions");h("seal");var q=0,m=function(a){this.id_=(q+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};m.prototype.set=function(b,c){if(!a(b))throw Error("Invalid WeakMap key");f(b);if(!$jscomp.owns(b,g))throw Error("WeakMap key fail: "+
b);b[g][this.id_]=c;return this};m.prototype.get=function(b){return a(b)&&$jscomp.owns(b,g)?b[g][this.id_]:void 0};m.prototype.has=function(b){return a(b)&&$jscomp.owns(b,g)&&$jscomp.owns(b[g],this.id_)};m.prototype.delete=function(b){return a(b)&&$jscomp.owns(b,g)&&$jscomp.owns(b[g],this.id_)?delete b[g][this.id_]:!1};return m},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(b){function c(){if($jscomp.ASSUME_NO_NATIVE_MAP||!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),c=new b($jscomp.makeIterator([[a,"s"]]));if("s"!=c.get(a)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),f=d.next();if(f.done||f.value[0]!=a||"s"!=f.value[1])return!1;f=d.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!d.next().done?!1:!0}catch(u){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(c())return b;$jscomp.initSymbolIterator();var d=new WeakMap,a=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};a.prototype.set=function(a,b){a=0===a?0:a;var c=f(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};a.prototype.delete=function(a){a=f(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(a){return!!f(this,a).entry};
a.prototype.get=function(a){return(a=f(this,a).entry)&&a.value};a.prototype.entries=function(){return h(this,function(a){return[a.key,a.value]})};a.prototype.keys=function(){return h(this,function(a){return a.key})};a.prototype.values=function(){return h(this,function(a){return a.value})};a.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};a.prototype[Symbol.iterator]=a.prototype.entries;var f=function(a,b){var c=b&&typeof b;"object"==
c||"function"==c?d.has(b)?c=d.get(b):(c=""+ ++q,d.set(b,c)):c="p_"+b;var f=a.data_[c];if(f&&$jscomp.owns(a.data_,c))for(a=0;a<f.length;a++){var g=f[a];if(b!==b&&g.key!==g.key||b===g.key)return{id:c,list:f,index:a,entry:g}}return{id:c,list:f,index:-1,entry:void 0}},h=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},q=0;return a},"es6","es3");$jscomp.polyfill("Array.from",function(b){return b?b:function(b,d,a){d=null!=d?d:function(a){return a};var c=[],h="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof h){b=h.call(b);for(var g=0;!(h=b.next()).done;)c.push(d.call(a,h.value,g++))}else for(h=b.length,g=0;g<h;g++)c.push(d.call(a,b[g],g));return c}},"es6","es3");
(function(b){function c(a){if(d[a])return d[a].exports;var f=d[a]={i:a,l:!1,exports:{}};b[a].call(f.exports,f,f.exports,c);f.l=!0;return f.exports}var d={};c.m=b;c.c=d;c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})};c.r=function(a){$jscomp.initSymbol();$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};c.t=function(a,
b){b&1&&(a=c(a));if(b&8||b&4&&"object"===typeof a&&a&&a.__esModule)return a;var d=Object.create(null);c.r(d);Object.defineProperty(d,"default",{enumerable:!0,value:a});if(b&2&&"string"!=typeof a)for(var f in a)c.d(d,f,function(b){return a[b]}.bind(null,f));return d};c.n=function(a){var b=a&&a.__esModule?function(){return a["default"]}:function(){return a};c.d(b,"a",b);return b};c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};c.p="";return c(c.s=1)})([,function(b,c,d){d.r(c);var a=
function(){};a.makeDiv=function(e){var a=document.createElement("div");e&&a.classList.add.apply(a.classList,$jscomp.arrayFromIterable(e));return a};a.makeDivContaining=function(e,a){var b=this.makeDiv(a);e.forEach(function(e){return b.appendChild(e)});return b};a.makeElement=function(e,a,b){e=document.createElement(e);e.innerText=a;b&&e.classList.add.apply(e.classList,$jscomp.arrayFromIterable(b));return e};a.makePara=function(e,b){return a.makeElement("p",e,b)};a.makeHeader=function(e,b,c){return a.makeElement("h"+
(void 0===b?1:b),e,c)};a.makeButton=function(e,a,b,c){c=void 0===c?!1:c;var l=document.createElement("button");l.type="button";l.disabled=c;l.innerText=e;b&&l.classList.add.apply(l.classList,$jscomp.arrayFromIterable(b));l.onclick=function(e){e.preventDefault;a.call(this,e)};return l};a.makeImg=function(e,a){var b=document.createElement("img");b.src=e;a&&b.classList.add.apply(b.classList,$jscomp.arrayFromIterable(a));return b};a.makeCanvas=function(a,b,c){var e=document.createElement("canvas");e.width=
a;e.height=b;c&&e.classList.add.apply(e.classList,$jscomp.arrayFromIterable(c));return e};a.fillHTML=function(e,a){e.innerHTML="";a.forEach(function(a){return e.appendChild(a)})};var f=function(){};f.renderMainMenu=function(){return a.makeDivContaining([a.makeHeader("Aurora",1),a.makeDivContaining([a.makeButton("Start",function(){return n.startGame()})])],["main-menu"])};var h=function(a,b){this.x=a;this.y=b};h.prototype.toString=function(){return"("+this.x+", "+this.y+")"};h.prototype.distanceFrom=
function(a){return Math.hypot(Math.abs(this.x-a.x),Math.abs(this.y-a.y))};var g=function(e,b){var l=this;this.viewWidth=12;this.viewHeight=8;this.viewPosition=new h(0,0);this.highlightedCoordinates=null;this.world=b;this.parentScreen=e;this.worldCanvas=a.makeCanvas(this.world.width*g.pixelsPerTile,this.world.height*g.pixelsPerTile);e=this.worldCanvas.getContext("2d");e.beginPath();e.rect(0,0,this.worldCanvas.width,this.worldCanvas.height);e.fillStyle="black";e.fill();this.viewCanvas=a.makeCanvas(this.viewWidth*
g.pixelsPerTile,this.viewHeight*g.pixelsPerTile,["map-canvas"]);this.viewCanvas.addEventListener("click",function(a){return l.handleClick(a)});this.refreshViewableArea()};g.prototype.getViewCanvas=function(){return this.viewCanvas};g.prototype.updateViewCanvas=function(){var a=this.viewCanvas.getContext("2d"),b=this.viewWidth*g.pixelsPerTile,c=this.viewHeight*g.pixelsPerTile;a.drawImage(this.worldCanvas,this.viewPosition.x*g.pixelsPerTile,this.viewPosition.y*g.pixelsPerTile,b,c,0,0,b,c)};g.prototype.refreshViewableArea=
function(){var a=this;this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,this.viewHeight).forEach(function(e){a.rerenderTile(e)})};g.prototype.drawImageAtCoordinates=function(a,b){var e=this,c=this.worldCanvas.getContext("2d");c.imageSmoothingEnabled=!1;var l=new Image;l.onload=function(){c.drawImage(l,b.x*g.pixelsPerTile,b.y*g.pixelsPerTile,g.pixelsPerTile,g.pixelsPerTile);e.updateViewCanvas()};l.src=a};g.prototype.rerenderTile=function(a){this.drawImageAtCoordinates(a.getImgSrc(),
a.position);a.position===this.highlightedCoordinates&&this.drawImageAtCoordinates("assets/ui/highlight.png",a.position)};g.prototype.selectTile=function(a){if(this.highlightedCoordinates){var e=this.world.getTileAtCoordinates(this.highlightedCoordinates);this.highlightedCoordinates=null;this.rerenderTile(e)}a?(this.drawImageAtCoordinates("assets/ui/highlight.png",a.position),this.highlightedCoordinates=a.position):this.highlightedCoordinates=null;this.parentScreen.changeSidebarTile(this.highlightedCoordinates)};
g.prototype.moveViewArea=function(a,b){var e=this,c=this.viewPosition.x,l=this.viewPosition.y;this.viewPosition=new h(Math.max(Math.min(this.viewPosition.x+a,this.world.width-this.viewWidth),0),Math.max(Math.min(this.viewPosition.y+b,this.world.height-this.viewHeight),0));a=this.viewPosition.x-c;b=this.viewPosition.y-l;0<a&&this.world.getTilesInRectangle(this.viewPosition.x+this.viewWidth-a,this.viewPosition.y,a,this.viewHeight).forEach(function(a){return e.rerenderTile(a)});0>a&&this.world.getTilesInRectangle(this.viewPosition.x,
this.viewPosition.y,-1*a,this.viewHeight).forEach(function(a){return e.rerenderTile(a)});0<b&&this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y+this.viewHeight-b,this.viewWidth,b).forEach(function(a){return e.rerenderTile(a)});0>b&&this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,-1*b).forEach(function(a){return e.rerenderTile(a)})};g.prototype.handleClick=function(a){a=this.world.getTileAtCoordinates(new h(Math.floor(this.viewWidth/this.viewCanvas.clientWidth*
(a.pageX-this.viewCanvas.offsetLeft))+this.viewPosition.x,Math.floor(this.viewHeight/this.viewCanvas.clientHeight*(a.pageY-this.viewCanvas.offsetTop))+this.viewPosition.y));this.selectTile(a)};g.prototype.handleKeyDown=function(a){a=a.code;"ArrowUp"!==a&&"KeyW"!==a||this.moveViewArea(0,-1);"ArrowLeft"!==a&&"KeyA"!==a||this.moveViewArea(-1,0);"ArrowDown"!==a&&"KeyS"!==a||this.moveViewArea(0,1);"ArrowRight"!==a&&"KeyD"!==a||this.moveViewArea(1,0)};g.pixelsPerTile=64;var q=function(b,c){this.parentScreen=
b;this.run=c;this.position=null;this.html=a.makeDiv(["world-screen-sidebar"]);this.refresh()};q.prototype.getHTML=function(){return this.html};q.prototype.changeTile=function(a){this.position=a;this.refresh()};q.prototype.refresh=function(){var b=this;if(null==this.position)a.fillHTML(this.html,[a.makePara("No structure or terrain tile selected")]);else{var c=this.run.world.getTileAtCoordinates(this.position),J=a.makeDiv();0<c.possibleProjects.length&&(J.appendChild(a.makePara("Projects:")),c.possibleProjects.forEach(function(a){J.appendChild(b.makeProjectHTML(c,
a))}));var d=a.makeDiv();0<c.resourceConversions.length&&(d.appendChild(a.makePara("Production:")),c.resourceConversions.forEach(function(a){d.appendChild(b.makeConversionHTML(a))}));a.fillHTML(this.html,[a.makePara(c.getTileName()),a.makePara("Coordinates: "+this.position.x+", "+this.position.y),J,d])}};q.prototype.makeProjectHTML=function(b,c){var e=this,l=a.makeDiv(),d=!c.canDo(b.position,this.run);d=a.makeButton(c.title,function(){e.doProject(c,b)},[],d);l.appendChild(d);0==c.costs.length?l.appendChild(a.makePara("Cost: Free")):
(d="Cost: "+c.costs.map(function(a){return""+a.toString()}).join(", "),l.appendChild(a.makePara(d)));0<c.completionRequirements.length&&(d=c.completionRequirements.map(function(a){return"- "+a.toString()+"\n"}).join(""),l.appendChild(a.makePara("Requirements:\n"+d)));return l};q.prototype.makeConversionHTML=function(b){return a.makePara("- "+b.toString())};q.prototype.doProject=function(a,b){a.doAction(b.position,this.run);this.parentScreen.refreshComponents()};var m=function(b){this.inventory=b.inventory;
this.html=a.makeDiv(["world-screen-inventory"]);this.refresh()};m.prototype.getHTML=function(){return this.html};m.prototype.refresh=function(){var b=a.makeDiv();this.inventory.getInventoryStrings().forEach(function(e){b.appendChild(a.makePara(e))});a.fillHTML(this.html,[a.makeDivContaining([a.makePara("Inventory:"),b])])};var I=function(b){this.html=a.makeDiv(["world-screen-header"]);this.run=b;this.refresh()};I.prototype.refresh=function(){var b=a.makeButton("Quit Game",function(){n.showMainMenu()}),
c=a.makeButton("Next Turn",function(){n.transitionToNextTurn()}),d=a.makeButton("Manage Production",function(){n.showProductionScreen()});a.fillHTML(this.html,[b,d,c])};I.prototype.getHTML=function(){return this.html};var D=function(b){this.mapUI=new g(this,b.world);this.tileSidebar=new q(this,b);var e=this.mapUI.getViewCanvas();this.inventorySidebar=new m(b);var c=this.tileSidebar.getHTML(),d=this.inventorySidebar.getHTML();this.header=new I(b);this.worldScreenHTML=a.makeDivContaining([this.header.getHTML(),
a.makeDivContaining([d,a.makeDivContaining([e],["world-screen-map-box"]),c],["world-screen-hbox"])],["flex-vertical"])};D.prototype.getHTML=function(){return this.worldScreenHTML};D.prototype.refreshComponents=function(){this.mapUI.refreshViewableArea();this.tileSidebar.refresh();this.inventorySidebar.refresh();this.header.refresh()};D.prototype.handleKeyDown=function(a){this.mapUI.handleKeyDown(a)};D.prototype.changeSidebarTile=function(a){this.tileSidebar.changeTile(a)};var G=function(){};G.generate=
function(a,b){for(var e=Array(a),c=0;c<a;c++)e[c]=b();return e};G.flatten=function(a){return a.reduce(function(a,b){a=void 0===a?[]:a;return a.concat(b)})};b=function(a){this.position=a};var u=function(a,b,c,d){this.title=a;this.action=b;this.costs=c;this.completionRequirements=d};u.prototype.canDo=function(a,b){return b.inventory.canAfford(this.costs)&&this.completionRequirements.every(function(e){return e.evaluate(b,a)})};u.prototype.doAction=function(a,b){if(!this.canDo(a,b))throw"tried to do project "+
this.title+" without meeting requirments";b.inventory.payCost(this.costs);this.action(a,b)};var v=function(a){this.position=a;this.possibleProjects=[];this.resourceConversions=[];return this};$jscomp.inherits(v,b);v.prototype.getImgSrc=function(){return"assets/tiles/habitat.png"};v.prototype.getTileName=function(){return v.tileName};v.tileName="Habitat Dome";var r=function(a,b){this.resource=a;this.quantity=b};r.prototype.toString=function(){return this.resource.name+" x"+this.quantity};var k=function(a){this.name=
a};k.values=function(){return Object.keys(k).map(function(a){return k[a]})};k.Energy=new k("Energy");k.Colonists=new k("Human Colonists");k.Metal=new k("Metal Ore");k.BuildingMaterials=new k("Construction Materials");k.Electronics=new k("Electronics");var E=function(a,b){this.radius=a;this.targetType=b;return this};$jscomp.inherits(E,function(){});E.prototype.evaluate=function(a,b){var c=this;return 0<a.world.getTilesInCircle(b,this.radius).filter(function(a){return a instanceof c.targetType}).length};
E.prototype.toString=function(){return 1==this.radius?"adjacent to a "+this.targetType.tileName:"within "+this.radius+" units of a "+this.targetType.tileName};var y=function(a,b){this.inputs=a;this.outputs=b;this.enabled=!0;0==a.length?this.priority=0:(this.priority=y.nextNumber,y.nextNumber++)};y.prototype.toString=function(){var a=this.outputs.map(function(a){return a.toString()}).join(", ");return 0==this.inputs.length?"Produce "+a:"Convert "+this.inputs.map(function(a){return a.toString()}).join(", ")+
" into "+a};y.nextNumber=1;var z=function(a){this.position=a;this.possibleProjects=[];this.resourceConversions=[new y([new r(k.Metal,100)],[new r(k.BuildingMaterials,100)]),new y([new r(k.Metal,100)],[new r(k.Electronics,100)])];return this};$jscomp.inherits(z,b);z.prototype.getImgSrc=function(){return"assets/tiles/mining_facility.png"};z.prototype.getTileName=function(){return z.tileName};z.tileName="Ore Processing Center";var w=function(a){this.position=a;this.possibleProjects=[new u("Strip Mining",
function(a,b){b.inventory.addQuantity(k.Metal,150);b.world.placeTile(new p(a))},[new r(k.Energy,25)],[])];this.resourceConversions=[];return this};$jscomp.inherits(w,b);w.prototype.getImgSrc=function(){return"assets/tiles/mountain.png"};w.prototype.getTileName=function(){return w.tileName};w.tileName="Mountain";var A=function(a){this.position=a;this.possibleProjects=[];this.resourceConversions=[new y([],[new r(k.Energy,100)])];return this};$jscomp.inherits(A,b);A.prototype.getImgSrc=function(){return"assets/tiles/solar_panels.png"};
A.prototype.getTileName=function(){return A.tileName};A.tileName="Photovoltaic Array";var p=function(a){this.position=a;this.possibleProjects=[new u("Construct habitat dome",function(a,b){b.world.placeTile(new v(a))},[new r(k.BuildingMaterials,100)],[new E(1,v)]),new u("Construct ore processing center",function(a,b){b.world.placeTile(new z(a))},[new r(k.Energy,200),new r(k.Metal,300)],[new E(5,w)]),new u("Construct photovoltaic array",function(a,b){b.world.placeTile(new A(a))},[new r(k.Electronics,
200)],[])];this.resourceConversions=[];return this};$jscomp.inherits(p,b);p.prototype.getImgSrc=function(){return"assets/tiles/wasteland.png"};p.prototype.getTileName=function(){return p.tileName};p.tileName="Wasteland";var B=function(){};B.realBetween=function(a,b){return Math.random()*(b-a)+a};B.intBetween=function(a,b){return Math.floor(B.realBetween(a,b))};B.fromArray=function(a){return a[B.intBetween(0,a.length)]};var C=function(a){var b=this;this.width=a.worldWidth;this.height=a.worldHeight;
this.grid=Array(this.height);for(var c=0;c<this.height;c++){this.grid[c]=Array(this.width);for(var e=0;e<this.width;e++)this.grid[c][e]=new p(new h(e,c))}a.nonrandomTiles.forEach(function(a){b.placeTile(a)});a=B.intBetween(a.minMountains,a.maxMountains);for(c=0;c<a;c++)e=this.getTiles().filter(function(a){return a instanceof p}),e=B.fromArray(e).position,this.placeTile(new w(e))};C.prototype.placeTile=function(a){this.grid[a.position.y][a.position.x]=a};C.prototype.getTiles=function(){return G.flatten(this.grid)};
C.prototype.getTilesInRectangle=function(a,b,c,d){0>b&&(b=0);0>a&&(a=0);var e=[];this.grid.slice(b,b+d).forEach(function(b){b.slice(a,a+c).forEach(function(a){return e.push(a)})});return e};C.prototype.getTileAtCoordinates=function(a){return this.grid[a.y][a.x]};C.prototype.getTilesInCircle=function(a,b){return this.getTiles().filter(function(c){return a.distanceFrom(c.position)<=b})};var t=function(){this.resourceQuantities=new Map([])};t.prototype.addQuantity=function(a,b){b=this.getQuantity(a)+
b;if(0>b)throw"Tried to set inventory "+a.name+" to negative value.";this.resourceQuantities.set(a,b)};t.prototype.removeQuantity=function(a,b){this.addQuantity(a,-1*b)};t.prototype.getQuantity=function(a){return this.resourceQuantities.get(a)||0};t.prototype.canAfford=function(a){var b=this,c=new Map;a.forEach(function(a){c.set(a.resource,a.quantity+(c.get(a.resource)||0))});return Array.from(c.keys()).every(function(a){var e=c.get(a);a=b.getQuantity(a);return e<=a})};t.prototype.payCost=function(a){var b=
this;if(this.canAfford(a))a.forEach(function(a){return b.removeQuantity(a.resource,a.quantity)});else throw"Cannot afford to pay cost";};t.prototype.getResourceList=function(){return Array.from(this.resourceQuantities.keys())};t.prototype.getInventoryStrings=function(){var a=this;return this.getResourceList().map(function(b){return b.name+": "+a.getQuantity(b)})};t.prototype.applyConversions=function(a){var b=this;a.forEach(function(a){b.canAfford(a.inputs)&&a.enabled&&(b.payCost(a.inputs),a.outputs.forEach(function(a){return b.addQuantity(a.resource,
a.quantity)}))})};t.prototype.clone=function(){var a=this,b=new t;this.getResourceList().forEach(function(c){b.addQuantity(c,a.getQuantity(c))});return b};var K=function(a,b,c,d,f){this.nonrandomTiles=a;this.worldWidth=b;this.worldHeight=c;this.minMountains=d;this.maxMountains=f};K.standardWorldParameters=function(){var a=[new p(new h(0,0)),new w(new h(1,0)),new p(new h(2,0)),new p(new h(0,1)),new z(new h(1,1)),new p(new h(2,1)),new A(new h(0,2)),new v(new h(1,2)),new p(new h(2,2))];return new K(a,
20,20,20,25)};var F=function(){this.turnNumber=1;this.world=new C(K.standardWorldParameters());this.inventory=new t;this.inventory.addQuantity(k.Colonists,100)};F.prototype.getResourceConversions=function(){var a=G.flatten(this.world.getTiles().map(function(a){return a.resourceConversions}));a.sort(function(a,b){return a.priority-b.priority});return a};F.prototype.completeTurn=function(){this.inventory.applyConversions(this.getResourceConversions());this.turnNumber++};F.prototype.increaseConversionPriority=
function(a){if(0!=a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&0!=c&&(b=b[c-1],0!=b.priority&&(c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value))}};F.prototype.decreaseConversionPriority=function(a){if(0!=a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&c!=b.length-1&&(b=b[c+1],c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value)}};var L=function(a,b){this.currentGame=
a;this.worldScreen=b};L.prototype.addResource=function(a,b){this.currentGame.inventory.addQuantity(a,b);this.worldScreen.refreshComponents()};var H=function(){this.html=a.makeDiv();a.fillHTML(this.html,[a.makePara("Loading...")])};H.prototype.getHTML=function(){return this.html};H.prototype.revealButton=function(){a.fillHTML(this.html,[a.makeButton("Continue",this.continueToNextTurn)])};H.prototype.continueToNextTurn=function(){n.showWorldScreen()};var x=function(b){this.run=b;this.html=a.makeDiv(["production-screen"]);
this.refresh()};x.prototype.refresh=function(){var b=this,c=this.run.inventory.clone(),d=this.run.getResourceConversions().filter(function(a){return 0==a.inputs.length}),f=d.map(function(a){return b.renderConversion(a,!0,!1)});c.applyConversions(d);var g=[];this.run.getResourceConversions().filter(function(a){return 0!=a.inputs.length}).forEach(function(a){c.canAfford(a.inputs)?(g.push(b.renderConversion(a,!0,!0)),c.applyConversions([a])):g.push(b.renderConversion(a,!1,!0))});a.fillHTML(this.html,
[a.makePara("Resource Production Report",["production-screen-label"]),a.makePara("Resources available at start of next production cycle:",["production-screen-label"]),this.renderInventory(this.run.inventory),a.makePara("Resource generation in next production cycle:",["production-screen-label"]),a.makeDivContaining(f),a.makePara("Resource conversion in next production cycle:",["production-screen-label"]),a.makeDivContaining(g),a.makePara("Resources available at end of next production cycle:",["production-screen-label"]),
this.renderInventory(c),a.makeButton("Back",function(){n.showWorldScreen()},["production-screen-back-button"])])};x.prototype.getHTML=function(){return this.html};x.prototype.renderInventory=function(b){b=b.getInventoryStrings().map(function(b){return a.makePara(b)});return a.makeDivContaining(b,["production-screen-inventory"])};x.prototype.renderConversion=function(b,c,d){var e=this,f=a.makeDiv(["flex-horizontal"]),g=b.toString(),h="conversion-description-normal";b.enabled?c||(g="(cannot afford) "+
b.toString(),h="conversion-description-cannot-afford"):(g="(disabled) "+b.toString(),h="conversion-description-disabled");f.appendChild(a.makeButton(g,function(){e.toggle(b)},[h,"conversion-description"]));d&&(f.appendChild(a.makeButton("Move Up",function(){return e.moveConversionUp(b)})),f.appendChild(a.makeButton("Move Down",function(){return e.moveConversionDown(b)})));return f};x.prototype.moveConversionUp=function(a){this.run.increaseConversionPriority(a);this.refresh()};x.prototype.moveConversionDown=
function(a){this.run.decreaseConversionPriority(a);this.refresh()};x.prototype.toggle=function(a){a.enabled=!a.enabled;this.refresh()};var n=function(){};n.showMainMenu=function(){this.disableCheats();a.fillHTML(this.rootDiv,[f.renderMainMenu()])};n.startGame=function(){this.currentRun=new F;this.showWorldScreen()};n.showWorldScreen=function(){var b=new D(this.currentRun);a.fillHTML(this.rootDiv,[b.getHTML()]);this.enableCheats(b);document.onkeydown=function(a){b.handleKeyDown(a)}};n.showProductionScreen=
function(){this.disableCheats();var b=new x(this.currentRun);a.fillHTML(this.rootDiv,[b.getHTML()])};n.transitionToNextTurn=function(){this.disableCheats();var b=new H;a.fillHTML(this.rootDiv,[b.getHTML()]);this.currentRun.completeTurn();b.revealButton()};n.enableCheats=function(a){window.cheats=new L(this.currentRun,a);window.Resources=k};n.disableCheats=function(){window.cheats=void 0;window.Resources=void 0};n.rootDiv=document.getElementById("rootdiv");window.onload=function(){console.log("Script Loaded");
n.showMainMenu()}}]);}).call(this || window)
</script><script type="text/javascript">(function(){'use strict';}).call(this || window)
</script></body> </html> 