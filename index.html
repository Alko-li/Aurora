<!doctype html> <html lang=en dir=ltr> <head> <meta charset=utf-8> <title>Aurora</title> <style type="text/css">.world-screen-hbox,.world-screen-header{display:flex;flex-direction:row;margin:0}.world-screen-map-box{height:100%;width:100%}.map-canvas{width:100%;margin:0}.world-screen-sidebar{background-color:#000;width:20%;margin:20px;font-size:16px}.world-screen-inventory{width:20%;margin:10px;font-size:16px}.production-screen{padding-left:10pt}.production-screen-label{font-size:20pt}.production-screen-inventory{font-size:16pt;line-height:0;padding:1pt;outline:solid #fff;width:50%}.conversion-description{font-size:16pt;width:50%;text-align:left}.conversion-description-normal{color:#fff}.conversion-description-cannot-afford{color:tomato}.conversion-description-disabled{color:#ff0}.production-screen-back-button{font-size:20pt;margin-top:20pt}:root,button{background-color:#000;color:#fff;font-family:monospace}button{font-size:18px}button:disabled,button[disabled]{color:grey;border-color:grey}.flex-horizontal{display:flex;flex-direction:row}.flex-vertical{display:flex;flex-direction:column}.fill-horizontal{width:100%;font-family:serif}.fill-vertical{height:100%}</style></head> <body> <div id=rootdiv> <p>Loading scripts...</p> </div> <script type="text/javascript">(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var e=0;return function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,e){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(f){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+e++,f)}var e=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var e,f=[];!(e=a.next()).done;)f.push(e.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var e=function(){};e.prototype=a;return new e};
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},e={};try{return e.__proto__=a,e.a}catch(f){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,e){a.__proto__=e;if(a.__proto__!==e)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,e){a.prototype=$jscomp.objectCreate(e.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var f=$jscomp.setPrototypeOf;f(a,e)}else for(f in e)if("prototype"!=f)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(e,f);d&&Object.defineProperty(a,f,d)}else a[f]=e[f];a.superClass_=e.prototype};
$jscomp.polyfill=function(a,e,f,d){if(e){f=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var c=a[d];c in f||(f[c]={});f=f[c]}a=a[a.length-1];d=f[a];e=e(d);e!=d&&null!=e&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Math.hypot",function(a){return a?a:function(a){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var e,d,c;for(e=c=0;e<arguments.length;e++)c=Math.max(c,Math.abs(arguments[e]));if(1e+100<c||1e-100>c){if(!c)return c;for(e=d=0;e<arguments.length;e++){var n=Number(arguments[e])/c;d+=n*n}return Math.sqrt(d)*c}for(e=d=0;e<arguments.length;e++)n=Number(arguments[e]),d+=n*n;return Math.sqrt(d)}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,f,d){var c=this.length||0;0>f&&(f=Math.max(0,c+f));if(null==d||d>c)d=c;d=Number(d);0>d&&(d=Math.max(0,c+d));for(f=Number(f||0);f<d;f++)this[f]=a;return this}},"es6","es3");
$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,d={next:function(){if(f<a.length){var c=f++;return{value:e(c,a[c]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},e=Object.create(new $jscomp.global.Proxy(a,{get:function(f,d,c){return f==a&&"q"==d&&c==e}}));return!0===e.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};
$jscomp.polyfill("WeakMap",function(a){function e(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),d=Object.seal({}),e=new a([[c,2],[d,3]]);if(2!=e.get(c)||3!=e.get(d))return!1;e.delete(c);e.set(d,4);return!e.has(c)&&4==e.get(d)}catch(F){return!1}}function f(){}function d(c){var a=typeof c;return"object"===a&&null!==c||"function"===a}function c(c){if(!$jscomp.owns(c,g)){var a=new f;$jscomp.defineProperty(c,g,{value:a})}}function n(a){var e=Object[a];e&&(Object[a]=function(a){if(a instanceof
f)return a;c(a);return e(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(e())return a;var g="$jscomp_hidden_"+Math.random();n("freeze");n("preventExtensions");n("seal");var k=0,q=function(c){this.id_=(k+=Math.random()+1).toString();if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};q.prototype.set=function(a,e){if(!d(a))throw Error("Invalid WeakMap key");c(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+
a);a[g][this.id_]=e;return this};q.prototype.get=function(c){return d(c)&&$jscomp.owns(c,g)?c[g][this.id_]:void 0};q.prototype.has=function(c){return d(c)&&$jscomp.owns(c,g)&&$jscomp.owns(c[g],this.id_)};q.prototype.delete=function(c){return d(c)&&$jscomp.owns(c,g)&&$jscomp.owns(c[g],this.id_)?delete c[g][this.id_]:!1};return q},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function e(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),e=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=e.get(c)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var d=e.entries(),f=d.next();if(f.done||f.value[0]!=c||"s"!=f.value[1])return!1;f=d.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!d.next().done?!1:!0}catch(F){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(e())return a;$jscomp.initSymbolIterator();var f=new WeakMap,d=function(c){this.data_={};this.head_=g();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};d.prototype.set=function(a,e){a=0===a?0:a;var d=c(this,a);d.list||(d.list=this.data_[d.id]=[]);d.entry?d.entry.value=e:(d.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:e},d.list.push(d.entry),this.head_.previous.next=d.entry,this.head_.previous=d.entry,this.size++);return this};d.prototype.delete=function(a){a=c(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(a){return!!c(this,a).entry};
d.prototype.get=function(a){return(a=c(this,a).entry)&&a.value};d.prototype.entries=function(){return n(this,function(c){return[c.key,c.value]})};d.prototype.keys=function(){return n(this,function(c){return c.key})};d.prototype.values=function(){return n(this,function(c){return c.value})};d.prototype.forEach=function(c,a){for(var e=this.entries(),d;!(d=e.next()).done;)d=d.value,c.call(a,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var c=function(c,a){var d=a&&typeof a;"object"==
d||"function"==d?f.has(a)?d=f.get(a):(d=""+ ++k,f.set(a,d)):d="p_"+a;var e=c.data_[d];if(e&&$jscomp.owns(c.data_,d))for(c=0;c<e.length;c++){var g=e[c];if(a!==a&&g.key!==g.key||a===g.key)return{id:d,list:e,index:c,entry:g}}return{id:d,list:e,index:-1,entry:void 0}},n=function(c,a){var d=c.head_;return $jscomp.iteratorPrototype(function(){if(d){for(;d.head!=c.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:a(d)};d=null}return{done:!0,value:void 0}})},g=function(){var c={};return c.previous=
c.next=c.head=c},k=0;return d},"es6","es3");$jscomp.polyfill("Array.from",function(a){return a?a:function(a,f,d){f=null!=f?f:function(c){return c};var c=[],e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof e){a=e.call(a);for(var g=0;!(e=a.next()).done;)c.push(f.call(d,e.value,g++))}else for(e=a.length,g=0;g<e;g++)c.push(f.call(d,a[g],g));return c}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,f){return f})}},"es8","es3");
(function(a){function e(d){if(f[d])return f[d].exports;var c=f[d]={i:d,l:!1,exports:{}};a[d].call(c.exports,c,c.exports,e);c.l=!0;return c.exports}var f={};e.m=a;e.c=f;e.d=function(a,c,f){e.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:f})};e.r=function(a){$jscomp.initSymbol();$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};e.t=function(a,
c){c&1&&(a=e(a));if(c&8||c&4&&"object"===typeof a&&a&&a.__esModule)return a;var d=Object.create(null);e.r(d);Object.defineProperty(d,"default",{enumerable:!0,value:a});if(c&2&&"string"!=typeof a)for(var f in a)e.d(d,f,function(c){return a[c]}.bind(null,f));return d};e.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};e.d(c,"a",c);return c};e.o=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};e.p="";return e(e.s=1)})([,function(a,e,f){function d(b,
a,c){return Math.max(Math.min(a,c),b)}f.r(e);var c=function(){};c.makeDiv=function(b){var a=document.createElement("div");b&&a.classList.add.apply(a.classList,$jscomp.arrayFromIterable(b));return a};c.makeDivContaining=function(b,a){var c=this.makeDiv(a);b.forEach(function(b){return c.appendChild(b)});return c};c.makeElement=function(b,a,c){b=document.createElement(b);b.innerText=a;c&&b.classList.add.apply(b.classList,$jscomp.arrayFromIterable(c));return b};c.makePara=function(b,a){return c.makeElement("p",
b,a)};c.makeHeader=function(b,a,P){return c.makeElement("h"+(void 0===a?1:a),b,P)};c.makeButton=function(b,a,c,d){d=void 0===d?!1:d;var h=document.createElement("button");h.type="button";h.disabled=d;h.innerText=b;c&&h.classList.add.apply(h.classList,$jscomp.arrayFromIterable(c));h.onclick=function(b){b.preventDefault;a.call(this,b)};return h};c.makeImg=function(b,a){var c=document.createElement("img");c.src=b;a&&c.classList.add.apply(c.classList,$jscomp.arrayFromIterable(a));return c};c.makeCanvas=
function(b,a,c){var h=document.createElement("canvas");h.width=b;h.height=a;c&&h.classList.add.apply(h.classList,$jscomp.arrayFromIterable(c));return h};c.fillHTML=function(b,a){b.innerHTML="";a.forEach(function(a){return b.appendChild(a)})};var n=function(){};n.renderMainMenu=function(){return c.makeDivContaining([c.makeHeader("Aurora",1),c.makeDivContaining([c.makeButton("Start",function(){return p.startGame()})])],["main-menu"])};var g=function(b,a){this.x=b;this.y=a};g.prototype.toString=function(){return"("+
this.x+", "+this.y+")"};g.prototype.distanceFrom=function(b){return Math.hypot(Math.abs(this.x-b.x),Math.abs(this.y-b.y))};var k=function(b,a){var h=this;this.viewWidth=12;this.viewHeight=8;this.viewPosition=new g(0,0);this.highlightedCoordinates=null;this.world=a;this.parentScreen=b;this.worldCanvas=c.makeCanvas(this.world.width*k.pixelsPerTile,this.world.height*k.pixelsPerTile);b=this.worldCanvas.getContext("2d");b.beginPath();b.rect(0,0,this.worldCanvas.width,this.worldCanvas.height);b.fillStyle=
"black";b.fill();this.viewCanvas=c.makeCanvas(this.viewWidth*k.pixelsPerTile,this.viewHeight*k.pixelsPerTile,["map-canvas"]);this.viewCanvas.addEventListener("click",function(b){return h.handleClick(b)});this.refreshViewableArea()};k.prototype.getViewCanvas=function(){return this.viewCanvas};k.prototype.updateViewCanvas=function(){var b=this.viewCanvas.getContext("2d"),a=this.viewWidth*k.pixelsPerTile,c=this.viewHeight*k.pixelsPerTile;b.drawImage(this.worldCanvas,this.viewPosition.x*k.pixelsPerTile,
this.viewPosition.y*k.pixelsPerTile,a,c,0,0,a,c)};k.prototype.refreshViewableArea=function(){var b=this;this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,this.viewHeight).forEach(function(a){b.rerenderTile(a)})};k.prototype.drawImageAtCoordinates=function(b,a){var c=this,h=this.worldCanvas.getContext("2d");h.imageSmoothingEnabled=!1;var d=new Image;d.onload=function(){h.drawImage(d,a.x*k.pixelsPerTile,a.y*k.pixelsPerTile,k.pixelsPerTile,k.pixelsPerTile);c.updateViewCanvas()};
d.src=b};k.prototype.rerenderTile=function(b){this.drawImageAtCoordinates(b.getImgSrc(),b.position);b.position===this.highlightedCoordinates&&this.drawImageAtCoordinates("assets/ui/highlight.png",b.position)};k.prototype.selectTile=function(b){if(this.highlightedCoordinates){var a=this.world.getTileAtCoordinates(this.highlightedCoordinates);this.highlightedCoordinates=null;this.rerenderTile(a)}b?(this.drawImageAtCoordinates("assets/ui/highlight.png",b.position),this.highlightedCoordinates=b.position):
this.highlightedCoordinates=null;this.parentScreen.changeSidebarTile(this.highlightedCoordinates)};k.prototype.moveViewArea=function(b,a){var c=this,h=this.viewPosition.x,e=this.viewPosition.y;b=d(0,this.viewPosition.x+b,this.world.width-this.viewWidth);a=d(0,this.viewPosition.y+a,this.world.height-this.viewHeight);this.viewPosition=new g(b,a);b=this.viewPosition.x-h;a=this.viewPosition.y-e;0<b&&this.world.getTilesInRectangle(this.viewPosition.x+this.viewWidth-b,this.viewPosition.y,b,this.viewHeight).forEach(function(b){return c.rerenderTile(b)});
0>b&&this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,-1*b,this.viewHeight).forEach(function(b){return c.rerenderTile(b)});0<a&&this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y+this.viewHeight-a,this.viewWidth,a).forEach(function(b){return c.rerenderTile(b)});0>a&&this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,-1*a).forEach(function(b){return c.rerenderTile(b)})};k.prototype.handleClick=function(b){b=this.world.getTileAtCoordinates(new g(Math.floor(this.viewWidth/
this.viewCanvas.clientWidth*(b.pageX-this.viewCanvas.offsetLeft))+this.viewPosition.x,Math.floor(this.viewHeight/this.viewCanvas.clientHeight*(b.pageY-this.viewCanvas.offsetTop))+this.viewPosition.y));this.selectTile(b)};k.prototype.handleKeyDown=function(b){b=b.code;"ArrowUp"!==b&&"KeyW"!==b||this.moveViewArea(0,-1);"ArrowLeft"!==b&&"KeyA"!==b||this.moveViewArea(-1,0);"ArrowDown"!==b&&"KeyS"!==b||this.moveViewArea(0,1);"ArrowRight"!==b&&"KeyD"!==b||this.moveViewArea(1,0)};k.pixelsPerTile=64;var q=
function(b,a){this.parentScreen=b;this.run=a;this.position=null;this.html=c.makeDiv(["world-screen-sidebar"]);this.refresh()};q.prototype.getHTML=function(){return this.html};q.prototype.changeTile=function(b){this.position=b;this.refresh()};q.prototype.refresh=function(){var b=this;if(null==this.position)c.fillHTML(this.html,[c.makePara("No structure or terrain tile selected")]);else{var a=this.run.world.getTileAtCoordinates(this.position),d=c.makeDiv();a.populationCapacity&&d.appendChild(c.makePara("Population capacity for "+
a.populationCapacity.capacity+" "+a.populationCapacity.species.name));var e=c.makeDiv();0<a.possibleProjects.length&&(e.appendChild(c.makePara("Projects:")),a.possibleProjects.forEach(function(c){e.appendChild(b.makeProjectHTML(a,c))}));var f=c.makeDiv();0<a.resourceConversions.length&&(f.appendChild(c.makePara("Production:")),a.resourceConversions.forEach(function(a){f.appendChild(b.makeConversionHTML(a))}));c.fillHTML(this.html,[c.makePara(a.getTileName()),c.makePara("Coordinates: "+this.position.x+
", "+this.position.y),d,e,f])}};q.prototype.makeProjectHTML=function(b,a){var h=this,d=c.makeDiv(),e=!a.canDo(b.position,this.run);e=c.makeButton(a.title,function(){h.doProject(a,b)},[],e);d.appendChild(e);0==a.costs.length?d.appendChild(c.makePara("Cost: Free")):(e="Cost: "+a.costs.map(function(b){return""+b.toString()}).join(", "),d.appendChild(c.makePara(e)));0<a.completionRequirements.length&&(e=a.completionRequirements.map(function(b){return"- "+b.toString()+"\n"}).join(""),d.appendChild(c.makePara("Requirements:\n"+
e)));return d};q.prototype.makeConversionHTML=function(b){return c.makePara("- "+b.toString())};q.prototype.doProject=function(b,a){b.doAction(a.position,this.run);this.parentScreen.refreshComponents()};var L=function(b){this.inventory=b.inventory;this.html=c.makeDiv(["world-screen-inventory"]);this.refresh()};L.prototype.getHTML=function(){return this.html};L.prototype.refresh=function(){var b=c.makeHeader("Population: "+this.inventory.getTotalPopulation(),1),a=c.makePara("Available workers: "+this.inventory.getAvailableWorkers()),
d=c.makeDiv();this.inventory.getPopulationStrings().forEach(function(b){d.appendChild(c.makePara(b))});var e=c.makeDiv();this.inventory.getInventoryStrings().forEach(function(b){e.appendChild(c.makePara(b))});c.fillHTML(this.html,[c.makeDivContaining([b,a,d,c.makeHeader("Inventory:",1),e])])};var M=function(b){this.html=c.makeDiv(["world-screen-header"]);this.run=b;this.refresh()};M.prototype.refresh=function(){var b=c.makeButton("Quit Game",function(){p.showMainMenu()}),a=c.makeButton("Next Turn",
function(){p.transitionToNextTurn()}),d=c.makeButton("Manage Production",function(){p.showProductionScreen()});c.fillHTML(this.html,[b,d,a])};M.prototype.getHTML=function(){return this.html};var H=function(b){this.mapUI=new k(this,b.world);this.tileSidebar=new q(this,b);var a=this.mapUI.getViewCanvas();this.inventorySidebar=new L(b);var d=this.tileSidebar.getHTML(),e=this.inventorySidebar.getHTML();this.header=new M(b);this.worldScreenHTML=c.makeDivContaining([this.header.getHTML(),c.makeDivContaining([e,
c.makeDivContaining([a],["world-screen-map-box"]),d],["world-screen-hbox"])],["flex-vertical"])};H.prototype.getHTML=function(){return this.worldScreenHTML};H.prototype.refreshComponents=function(){this.mapUI.refreshViewableArea();this.tileSidebar.refresh();this.inventorySidebar.refresh();this.header.refresh()};H.prototype.handleKeyDown=function(b){this.mapUI.handleKeyDown(b)};H.prototype.changeSidebarTile=function(b){this.tileSidebar.changeTile(b)};var F=function(){};F.generate=function(b,a){for(var c=
Array(b),h=0;h<b;h++)c[h]=a();return c};F.flatten=function(b){return b.reduce(function(b,a){b=void 0===b?[]:b;return b.concat(a)})};var u=function(b){this.position=b;this.possibleProjects=[];this.resourceConversions=[];this.populationCapacity=void 0},G=function(b,a,c,d){this.title=b;this.action=a;this.costs=c;this.completionRequirements=d};G.prototype.canDo=function(b,a){return a.inventory.canAfford(this.costs)&&this.completionRequirements.every(function(c){return c.evaluate(a,b)})};G.prototype.doAction=
function(b,a){if(!this.canDo(b,a))throw"tried to do project "+this.title+" without meeting requirments";a.inventory.payCost(this.costs);this.action(b,a)};var w=function(b,a){this.name=b;this.growthMultiplier=a};w.values=function(){return Object.keys(w).map(function(b){return w[b]})};w.Human=new w("Human Colonists",.1);w.Robot=new w("Robotic Platform",1);var Q=function(b,a){this.species=b;this.capacity=a},x=function(b){b=u.call(this,b)||this;b.populationCapacity=new Q(w.Human,200);return b};$jscomp.inherits(x,
u);x.prototype.getImgSrc=function(){return"assets/tiles/habitat.png"};x.prototype.getTileName=function(){return x.tileName};x.tileName="Habitat Dome";var t=function(b,a){this.resource=b;this.quantity=a};t.prototype.toString=function(){return this.resource.name+" x"+this.quantity};var l=function(b){this.name=b};l.values=function(){return Object.keys(l).map(function(b){return l[b]})};l.Energy=new l("Energy");l.Metal=new l("Metal Ore");l.BuildingMaterials=new l("Construction Materials");l.Electronics=
new l("Electronics");var I=function(b,a){this.radius=b;this.targetType=a;return this};$jscomp.inherits(I,function(){});I.prototype.evaluate=function(b,a){var c=this;return 0<b.world.getTilesInCircle(a,this.radius).filter(function(b){return b instanceof c.targetType}).length};I.prototype.toString=function(){return 1==this.radius?"adjacent to a "+this.targetType.tileName:"within "+this.radius+" units of a "+this.targetType.tileName};var y=function(b,a,c){this.inputs=b;this.outputs=a;this.enabled=!0;
this.requiredWorkers=c||0;this.isFree()?this.priority=0:(this.priority=y.nextNumber,y.nextNumber++)};y.prototype.toString=function(){var b=this.outputs.map(function(b){return b.toString()}).join(", "),a="Produce "+b;0<this.inputs.length&&(a="Convert "+this.inputs.map(function(b){return b.toString()}).join(", ")+" into "+b);0!=this.requiredWorkers&&(a+=" using "+this.requiredWorkers+" workers");return a};y.prototype.isFree=function(){return 0==this.inputs.length&&!this.requiredWorkers};y.nextNumber=
1;var B=function(b){b=u.call(this,b)||this;b.resourceConversions=[new y([new t(l.Metal,100)],[new t(l.BuildingMaterials,100)],60),new y([new t(l.Metal,100)],[new t(l.Electronics,100)],30)];return b};$jscomp.inherits(B,u);B.prototype.getImgSrc=function(){return"assets/tiles/mining_facility.png"};B.prototype.getTileName=function(){return B.tileName};B.tileName="Ore Processing Center";var z=function(b){b=u.call(this,b)||this;b.possibleProjects=[new G("Strip Mining",function(b,a){a.inventory.addResource(l.Metal,
150);a.world.placeTile(new r(b))},[new t(l.Energy,25)],[])];return b};$jscomp.inherits(z,u);z.prototype.getImgSrc=function(){return"assets/tiles/mountain.png"};z.prototype.getTileName=function(){return z.tileName};z.tileName="Mountain";var C=function(b){b=u.call(this,b)||this;b.resourceConversions=[new y([],[new t(l.Energy,100)])];return b};$jscomp.inherits(C,u);C.prototype.getImgSrc=function(){return"assets/tiles/solar_panels.png"};C.prototype.getTileName=function(){return C.tileName};C.tileName=
"Photovoltaic Array";var r=function(b){b=u.call(this,b)||this;b.possibleProjects=[new G("Construct habitat dome",function(b,a){a.world.placeTile(new x(b))},[new t(l.BuildingMaterials,100)],[new I(1,x)]),new G("Construct ore processing center",function(b,a){a.world.placeTile(new B(b))},[new t(l.Energy,200),new t(l.Metal,300)],[new I(5,z)]),new G("Construct photovoltaic array",function(b,a){a.world.placeTile(new C(b))},[new t(l.Electronics,200)],[])];return b};$jscomp.inherits(r,u);r.prototype.getImgSrc=
function(){return"assets/tiles/wasteland.png"};r.prototype.getTileName=function(){return r.tileName};r.tileName="Wasteland";var D=function(){};D.realBetween=function(b,a){return Math.random()*(a-b)+b};D.intBetween=function(b,a){return Math.floor(D.realBetween(b,a))};D.fromArray=function(b){return b[D.intBetween(0,b.length)]};var E=function(b){var a=this;this.width=b.worldWidth;this.height=b.worldHeight;this.grid=Array(this.height);for(var c=0;c<this.height;c++){this.grid[c]=Array(this.width);for(var d=
0;d<this.width;d++)this.grid[c][d]=new r(new g(d,c))}b.nonrandomTiles.forEach(function(b){a.placeTile(b)});b=D.intBetween(b.minMountains,b.maxMountains);for(c=0;c<b;c++)d=this.getTiles().filter(function(b){return b instanceof r}),d=D.fromArray(d).position,this.placeTile(new z(d))};E.prototype.placeTile=function(b){this.grid[b.position.y][b.position.x]=b};E.prototype.getTiles=function(){return F.flatten(this.grid)};E.prototype.getTilesInRectangle=function(b,a,c,d){0>a&&(a=0);0>b&&(b=0);var e=[];this.grid.slice(a,
a+d).forEach(function(a){a.slice(b,b+c).forEach(function(b){return e.push(b)})});return e};E.prototype.getTileAtCoordinates=function(b){return this.grid[b.y][b.x]};E.prototype.getTilesInCircle=function(b,a){return this.getTiles().filter(function(c){return b.distanceFrom(c.position)<=a})};E.prototype.getPopulationCapacity=function(b){var a=0;this.getTiles().forEach(function(c){c.populationCapacity&&c.populationCapacity.species==b&&(a+=c.populationCapacity.capacity)});return a};var v=function(){this.map=
new Map([])};v.prototype.add=function(b,a){this.set(b,this.get(b)+a)};v.prototype.remove=function(b,a){this.add(b,-1*a)};v.prototype.get=function(b){return this.map.get(b)||0};v.prototype.set=function(b,a){if(0>a)throw"tried to set quantity to negative value";0==a?this.map.delete(b):this.map.set(b,a)};v.prototype.getSum=function(){return Array.from(this.map.values()).reduce(function(a,c){return a+c},0)};v.prototype.positiveQuantityKeys=function(){return Array.from(this.map.keys())};v.prototype.clone=
function(){var a=this,c=new v;this.positiveQuantityKeys().forEach(function(b){return c.add(b,a.get(b))});return c};var m=function(a){this.world=a;this.resourceQuantities=new v;this.populationQuantities=new v;this.availableWorkers=0};m.prototype.addResource=function(a,c){this.resourceQuantities.add(a,c)};m.prototype.removeResource=function(a,c){this.resourceQuantities.remove(a,c)};m.prototype.getResourceQuantity=function(a){return this.resourceQuantities.get(a)||0};m.prototype.addWorkers=function(a,
c){this.populationQuantities.add(a,c);this.populationQuantities.set(a,d(0,this.populationQuantities.get(a),this.world.getPopulationCapacity(a)))};m.prototype.releaseWorkers=function(){this.availableWorkers=this.populationQuantities.getSum()};m.prototype.occupyWorkers=function(a){if(this.availableWorkers<a)throw"insufficient workers";if(0>a)throw"tried to occupy a negative number of workers";this.availableWorkers-=a};m.prototype.doPopulationGrowth=function(){var a=this;this.populationQuantities.positiveQuantityKeys().forEach(function(b){var c=
Math.floor(b.growthMultiplier*a.populationQuantities.get(b));a.addWorkers(b,c)})};m.prototype.getTotalPopulation=function(){return this.populationQuantities.getSum()};m.prototype.getAvailableWorkers=function(){return this.availableWorkers};m.prototype.canAfford=function(a){var b=this,c=new Map;a.forEach(function(a){c.set(a.resource,a.quantity+(c.get(a.resource)||0))});return Array.from(c.keys()).every(function(a){var d=c.get(a);a=b.getResourceQuantity(a);return d<=a})};m.prototype.hasEnoughWorkers=
function(a){return this.availableWorkers>a};m.prototype.payCost=function(a){var b=this;if(this.canAfford(a))a.forEach(function(a){return b.removeResource(a.resource,a.quantity)});else throw"Cannot afford to pay cost";};m.prototype.getResourceList=function(){return this.resourceQuantities.positiveQuantityKeys()};m.prototype.getInventoryStrings=function(){var a=this;return this.getResourceList().map(function(b){return b.name+": "+a.getResourceQuantity(b)})};m.prototype.getPopulationStrings=function(){var a=
this;return this.populationQuantities.positiveQuantityKeys().map(function(b){return a.populationQuantities.get(b)+" "+b.name})};m.prototype.applyConversions=function(a){var b=this;a.forEach(function(a){b.canAfford(a.inputs)&&b.hasEnoughWorkers(a.requiredWorkers)&&a.enabled&&(b.payCost(a.inputs),b.occupyWorkers(a.requiredWorkers),a.outputs.forEach(function(a){return b.addResource(a.resource,a.quantity)}))})};m.prototype.clone=function(){var a=new m(this.world);a.resourceQuantities=this.resourceQuantities.clone();
a.populationQuantities=this.populationQuantities.clone();a.availableWorkers=this.availableWorkers;return a};var N=function(a,c,d,e,f){this.nonrandomTiles=a;this.worldWidth=c;this.worldHeight=d;this.minMountains=e;this.maxMountains=f};N.standardWorldParameters=function(){var a=[new r(new g(0,0)),new z(new g(1,0)),new r(new g(2,0)),new r(new g(0,1)),new B(new g(1,1)),new r(new g(2,1)),new C(new g(0,2)),new x(new g(1,2)),new r(new g(2,2))];return new N(a,20,20,20,25)};var J=function(){this.turnNumber=
1;this.world=new E(N.standardWorldParameters());this.inventory=new m(this.world);this.inventory.addWorkers(w.Human,100);this.inventory.releaseWorkers()};J.prototype.getResourceConversions=function(){var a=F.flatten(this.world.getTiles().map(function(a){return a.resourceConversions}));a.sort(function(a,b){return a.priority-b.priority});return a};J.prototype.completeTurn=function(){this.inventory.applyConversions(this.getResourceConversions());this.inventory.releaseWorkers();this.inventory.doPopulationGrowth();
this.turnNumber++};J.prototype.increaseConversionPriority=function(a){if(0!=a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&0!=c&&(b=b[c-1],0!=b.priority&&(c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value))}};J.prototype.decreaseConversionPriority=function(a){if(0!=a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&c!=b.length-1&&(b=b[c+1],c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,
b.priority=c.next().value)}};var O=function(a,c){this.currentGame=a;this.worldScreen=c};O.prototype.addResource=function(a,c){this.currentGame.inventory.addResource(a,c);this.worldScreen.refreshComponents()};var K=function(){this.html=c.makeDiv();c.fillHTML(this.html,[c.makePara("Loading...")])};K.prototype.getHTML=function(){return this.html};K.prototype.revealButton=function(){c.fillHTML(this.html,[c.makeButton("Continue",this.continueToNextTurn)])};K.prototype.continueToNextTurn=function(){p.showWorldScreen()};
var A=function(a){this.run=a;this.html=c.makeDiv(["production-screen"]);this.refresh()};A.prototype.refresh=function(){var a=this,d=this.run.inventory.clone(),e=this.run.getResourceConversions().filter(function(a){return a.isFree()}),f=e.map(function(b){return a.renderConversion(b,!0,!1)});d.applyConversions(e);var g=[];this.run.getResourceConversions().filter(function(a){return!a.isFree()}).forEach(function(b){d.canAfford(b.inputs)&&d.hasEnoughWorkers(b.requiredWorkers)?(g.push(a.renderConversion(b,
!0,!0)),d.applyConversions([b])):g.push(a.renderConversion(b,!1,!0))});c.fillHTML(this.html,[c.makePara("Resource Production Report",["production-screen-label"]),c.makePara("Available workers at start of next production cycle: "+this.run.inventory.getAvailableWorkers(),["production-screen-label"]),c.makePara("Resources available at start of next production cycle:",["production-screen-label"]),this.renderInventory(this.run.inventory),c.makePara("Resource generation in next production cycle:",["production-screen-label"]),
c.makeDivContaining(f),c.makePara("Resource conversion in next production cycle:",["production-screen-label"]),c.makeDivContaining(g),c.makePara("Unused workers at end of next production cycle: "+d.getAvailableWorkers(),["production-screen-label"]),c.makePara("Resources available at end of next production cycle:",["production-screen-label"]),this.renderInventory(d),c.makeButton("Back",function(){p.showWorldScreen()},["production-screen-back-button"])])};A.prototype.getHTML=function(){return this.html};
A.prototype.renderInventory=function(a){a=a.getInventoryStrings().map(function(a){return c.makePara(a)});0==a.length&&a.push(c.makePara("(none)"));return c.makeDivContaining(a,["production-screen-inventory"])};A.prototype.renderConversion=function(a,d,e){var b=this,f=c.makeDiv(["flex-horizontal"]),g=a.toString(),h="conversion-description-normal";a.enabled?d||(g="(cannot afford) "+a.toString(),h="conversion-description-cannot-afford"):(g="(disabled) "+a.toString(),h="conversion-description-disabled");
f.appendChild(c.makeButton(g,function(){b.toggle(a)},[h,"conversion-description"]));e&&(f.appendChild(c.makeButton("Move Up",function(){return b.moveConversionUp(a)})),f.appendChild(c.makeButton("Move Down",function(){return b.moveConversionDown(a)})));return f};A.prototype.moveConversionUp=function(a){this.run.increaseConversionPriority(a);this.refresh()};A.prototype.moveConversionDown=function(a){this.run.decreaseConversionPriority(a);this.refresh()};A.prototype.toggle=function(a){a.enabled=!a.enabled;
this.refresh()};var p=function(){};p.showMainMenu=function(){this.disableCheats();c.fillHTML(this.rootDiv,[n.renderMainMenu()])};p.startGame=function(){this.currentRun=new J;this.showWorldScreen()};p.showWorldScreen=function(){var a=new H(this.currentRun);c.fillHTML(this.rootDiv,[a.getHTML()]);this.enableCheats(a);document.onkeydown=function(b){a.handleKeyDown(b)}};p.showProductionScreen=function(){this.disableCheats();var a=new A(this.currentRun);c.fillHTML(this.rootDiv,[a.getHTML()])};p.transitionToNextTurn=
function(){this.disableCheats();var a=new K;c.fillHTML(this.rootDiv,[a.getHTML()]);this.currentRun.completeTurn();a.revealButton()};p.enableCheats=function(a){window.cheats=new O(this.currentRun,a);window.Resources=l};p.disableCheats=function(){window.cheats=void 0;window.Resources=void 0};p.rootDiv=document.getElementById("rootdiv");window.onload=function(){console.log("Script Loaded");p.showMainMenu()}}]);}).call(this || window)
</script><script type="text/javascript">(function(){'use strict';}).call(this || window)
</script></body> </html> 