<!doctype html> <html lang=en dir=ltr> <head> <meta charset=utf-8> <title>Aurora</title> <style type="text/css">.main-menu{display:flex;flex-direction:column}.main-menu h1{font-size:40pt;margin:0;padding:0}.main-menu-options button{display:flex;flex-direction:column}.main-menu button{font-size:24pt;border:none;margin:0;padding:0}.main-menu button:hover{font-size:30pt}.main-menu button:active{color:grey}.credits h1{font-size:24pt;margin-bottom:10pt}.credits-container{display:flex;flex-direction:row}.credits-names-column{margin-right:24pt}.credits-name,.credits-roles{font-size:20pt;margin-top:0;margin-bottom:5pt}.credits button{margin-top:10pt;font-size:20pt}.world-screen-header{display:flex;flex-direction:row;margin:0;min-height:60px}.world-screen-quest-description{font-size:16px;padding-right:10px;padding-top:0;padding-bottom:0}.quest-description-emphasis{color:#408040;font-weight:700}.world-screen-hbox{margin:0;display:flex;flex-direction:row}.world-screen-map-box{height:100%;width:100%}.map-canvas{width:100%;margin:0}.world-screen-sidebar{background-color:#000;width:20%;margin:20px;font-size:16px}.world-screen-inventory{width:20%;margin:10px;font-size:16px}.production-screen{padding-left:10pt}.production-screen-label{font-size:20pt}.production-screen-inventory{font-size:16pt;line-height:0;padding:1pt;outline:solid #fff;width:50%}.conversion-description{font-size:16pt;width:50%;text-align:left}.conversion-description-normal{color:#fff}.conversion-description-cannot-afford{color:tomato}.conversion-description-disabled{color:#ff0}.production-screen-back-button{font-size:20pt;margin-top:20pt}:root,button{background-color:#000;color:#fff;font-family:monospace}button{font-size:18px}button:focus{outline:0}button:disabled,button[disabled]{color:grey;border-color:grey}.flex-horizontal{display:flex;flex-direction:row}.flex-vertical{display:flex;flex-direction:column}.fill-horizontal{width:100%;font-family:serif}.fill-vertical{height:100%}</style></head> <body> <div id=rootdiv> <p>Loading scripts...</p> </div> <script type="text/javascript">(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,f){a!=Array.prototype&&a!=Object.prototype&&(a[d]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,d){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(f){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+d++,f)}var d=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var d,f=[];!(d=a.next()).done;)f.push(d.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var d=function(){};d.prototype=a;return new d};
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},d={};try{return d.__proto__=a,d.a}catch(f){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,d){a.__proto__=d;if(a.__proto__!==d)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,d){a.prototype=$jscomp.objectCreate(d.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var f=$jscomp.setPrototypeOf;f(a,d)}else for(f in d)if("prototype"!=f)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(d,f);e&&Object.defineProperty(a,f,e)}else a[f]=d[f];a.superClass_=d.prototype};
$jscomp.polyfill=function(a,d,f,e){if(d){f=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var h=a[e];h in f||(f[h]={});f=f[h]}a=a[a.length-1];e=f[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Math.hypot",function(a){return a?a:function(a){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var d,e,h;for(d=h=0;d<arguments.length;d++)h=Math.max(h,Math.abs(arguments[d]));if(1e+100<h||1e-100>h){if(!h)return h;for(d=e=0;d<arguments.length;d++){var m=Number(arguments[d])/h;e+=m*m}return Math.sqrt(e)*h}for(d=e=0;d<arguments.length;d++)m=Number(arguments[d]),e+=m*m;return Math.sqrt(e)}},"es6","es3");
$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,e={next:function(){if(f<a.length){var h=f++;return{value:d(h,a[h]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},d=Object.create(new $jscomp.global.Proxy(a,{get:function(f,e,h){return f==a&&"q"==e&&h==d}}));return!0===d.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};
$jscomp.polyfill("WeakMap",function(a){function d(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),d=Object.seal({}),k=new a([[c,2],[d,3]]);if(2!=k.get(c)||3!=k.get(d))return!1;k.delete(c);k.set(d,4);return!k.has(c)&&4==k.get(d)}catch(L){return!1}}function f(){}function e(c){var a=typeof c;return"object"===a&&null!==c||"function"===a}function h(a){if(!$jscomp.owns(a,c)){var d=new f;$jscomp.defineProperty(a,c,{value:d})}}function m(a){var c=Object[a];c&&(Object[a]=function(a){if(a instanceof
f)return a;h(a);return c(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(d())return a;var c="$jscomp_hidden_"+Math.random();m("freeze");m("preventExtensions");m("seal");var K=0,k=function(a){this.id_=(K+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};k.prototype.set=function(a,d){if(!e(a))throw Error("Invalid WeakMap key");h(a);if(!$jscomp.owns(a,c))throw Error("WeakMap key fail: "+
a);a[c][this.id_]=d;return this};k.prototype.get=function(a){return e(a)&&$jscomp.owns(a,c)?a[c][this.id_]:void 0};k.prototype.has=function(a){return e(a)&&$jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)};k.prototype.delete=function(a){return e(a)&&$jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)?delete a[c][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function d(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),d=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=d.get(c)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=c||"s"!=f.value[1])return!1;f=e.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!e.next().done?!1:!0}catch(L){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(d())return a;$jscomp.initSymbolIterator();var f=new WeakMap,e=function(a){this.data_={};this.head_=c();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};e.prototype.set=function(a,c){a=0===a?0:a;var d=h(this,a);d.list||(d.list=this.data_[d.id]=[]);d.entry?d.entry.value=c:(d.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:c},d.list.push(d.entry),this.head_.previous.next=d.entry,this.head_.previous=d.entry,this.size++);return this};e.prototype.delete=function(a){a=h(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=c();this.size=0};e.prototype.has=function(a){return!!h(this,a).entry};
e.prototype.get=function(a){return(a=h(this,a).entry)&&a.value};e.prototype.entries=function(){return m(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return m(this,function(a){return a.key})};e.prototype.values=function(){return m(this,function(a){return a.value})};e.prototype.forEach=function(a,c){for(var d=this.entries(),e;!(e=d.next()).done;)e=e.value,a.call(c,e[1],e[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var h=function(a,c){var d=c&&typeof c;"object"==
d||"function"==d?f.has(c)?d=f.get(c):(d=""+ ++K,f.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var h=e[a];if(c!==c&&h.key!==h.key||c===h.key)return{id:d,list:e,index:a,entry:h}}return{id:d,list:e,index:-1,entry:void 0}},m=function(a,c){var d=a.head_;return $jscomp.iteratorPrototype(function(){if(d){for(;d.head!=a.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:c(d)};d=null}return{done:!0,value:void 0}})},c=function(){var a={};return a.previous=
a.next=a.head=a},K=0;return e},"es6","es3");$jscomp.polyfill("Array.from",function(a){return a?a:function(a,f,e){f=null!=f?f:function(a){return a};var d=[],m="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof m){a=m.call(a);for(var c=0;!(m=a.next()).done;)d.push(f.call(e,m.value,c++))}else for(m=a.length,c=0;c<m;c++)d.push(f.call(e,a[c],c));return d}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,f){return f})}},"es8","es3");
(function(a){function d(e){if(f[e])return f[e].exports;var h=f[e]={i:e,l:!1,exports:{}};a[e].call(h.exports,h,h.exports,d);h.l=!0;return h.exports}var f={};d.m=a;d.c=f;d.d=function(a,f,m){d.o(a,f)||Object.defineProperty(a,f,{enumerable:!0,get:m})};d.r=function(a){$jscomp.initSymbol();$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};d.t=function(a,
f){f&1&&(a=d(a));if(f&8||f&4&&"object"===typeof a&&a&&a.__esModule)return a;var e=Object.create(null);d.r(e);Object.defineProperty(e,"default",{enumerable:!0,value:a});if(f&2&&"string"!=typeof a)for(var c in a)d.d(e,c,function(c){return a[c]}.bind(null,c));return e};d.n=function(a){var e=a&&a.__esModule?function(){return a["default"]}:function(){return a};d.d(e,"a",e);return e};d.o=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};d.p="";return d(d.s=1)})([,function(a,d,f){function e(b,
g,a){return Math.max(Math.min(g,a),b)}function h(b,g){var a=new P(b,g);window.cheatsAddResource=function(b,g){return a.addResource(b,g)};window.cheatsAddPopulation=function(b,g){return a.addPopulation(b,g)};window.Resources=l;window.Species=w}function m(){window.cheats=void 0;window.Resources=void 0;window.Species=void 0}f.r(d);var c=function(){};c.makeDiv=function(b){var g=document.createElement("div");b&&g.classList.add.apply(g.classList,$jscomp.arrayFromIterable(b));return g};c.makeDivContaining=
function(b,g){g=this.makeDiv(g);b=$jscomp.makeIterator(b);for(var a=b.next();!a.done;a=b.next())g.appendChild(a.value);return g};c.makeElement=function(b,g,a){b=document.createElement(b);b.innerText=g;a&&b.classList.add.apply(b.classList,$jscomp.arrayFromIterable(a));return b};c.makePara=function(b,g){return c.makeElement("p",b,g)};c.makeHeader=function(b,g,a){return c.makeElement("h"+(void 0===g?1:g),b,a)};c.makeButton=function(b,g,a,c){c=void 0===c?!1:c;var E=document.createElement("button");E.type=
"button";E.disabled=c;E.innerText=b;a&&E.classList.add.apply(E.classList,$jscomp.arrayFromIterable(a));E.onclick=function(b){b.preventDefault;g.call(this,b)};return E};c.makeImg=function(b,g){var a=document.createElement("img");a.src=b;g&&a.classList.add.apply(a.classList,$jscomp.arrayFromIterable(g));return a};c.makeCanvas=function(b,g,a){var c=document.createElement("canvas");c.width=b;c.height=g;a&&c.classList.add.apply(c.classList,$jscomp.arrayFromIterable(a));return c};c.fillHTML=function(b,
g){b.innerHTML="";g=$jscomp.makeIterator(g);for(var a=g.next();!a.done;a=g.next())b.appendChild(a.value)};var K=function(){};K.renderMainMenu=function(){return c.makeDivContaining([c.makeHeader("Aurora",1),c.makeDivContaining([c.makeButton("start_game",function(){return r.startGame()}),c.makeButton("display_credits",function(){return r.showCredits()})],["main-menu-options"])],["main-menu"])};var k=function(b,a){this.x=b;this.y=a};k.prototype.toString=function(){return"("+this.x+", "+this.y+")"};k.prototype.distanceFrom=
function(b){return Math.hypot(Math.abs(this.x-b.x),Math.abs(this.y-b.y))};var p=function(b,a){var g=this;this.viewWidth=12;this.viewHeight=8;this.viewPosition=new k(0,0);this.highlightedCoordinates=null;this.world=a;this.parentScreen=b;this.canvas=c.makeCanvas(this.viewWidth*p.pixelsPerTile,this.viewHeight*p.pixelsPerTile,["map-canvas"]);this.canvas.addEventListener("click",function(b){return g.handleClick(b)});this.refreshViewableArea()};p.prototype.getViewCanvas=function(){return this.canvas};p.prototype.refreshViewableArea=
function(){var b=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,this.viewHeight);b=$jscomp.makeIterator(b);for(var a=b.next();!a.done;a=b.next())this.rerenderTile(a.value)};p.prototype.drawSquareAtCoordinates=function(b,a){var g=this.canvas.getContext("2d");g.imageSmoothingEnabled=!1;var c=new Image,d=a.x-this.viewPosition.x,e=a.y-this.viewPosition.y;0>d||0>e||d>=this.viewWidth||e>=this.viewHeight||(c.onload=function(){g.drawImage(c,d*p.pixelsPerTile,e*p.pixelsPerTile,
p.pixelsPerTile,p.pixelsPerTile)},c.src=b)};p.prototype.rerenderTile=function(b){this.drawSquareAtCoordinates(b.getImgSrc(),b.position);b.position===this.highlightedCoordinates&&this.drawSquareAtCoordinates("assets/ui/highlight.png",b.position)};p.prototype.selectTile=function(b){if(!b||b.position!==this.highlightedCoordinates){if(this.highlightedCoordinates){var a=this.world.getTileAtCoordinates(this.highlightedCoordinates);this.highlightedCoordinates=null;this.rerenderTile(a)}b?(this.drawSquareAtCoordinates("assets/ui/highlight.png",
b.position),this.highlightedCoordinates=b.position):this.highlightedCoordinates=null;this.parentScreen.changeSidebarTile(this.highlightedCoordinates)}};p.prototype.moveViewArea=function(b,a){var g=this.viewPosition.x,c=this.viewPosition.y;b=e(0,this.viewPosition.x+b,this.world.width-this.viewWidth);a=e(0,this.viewPosition.y+a,this.world.height-this.viewHeight);this.viewPosition=new k(b,a);b=this.viewPosition.x-g;a=this.viewPosition.y-c;g=b*p.pixelsPerTile*-1;c=a*p.pixelsPerTile*-1;this.canvas.getContext("2d").drawImage(this.canvas,
g,c);if(0<b)for(g=this.world.getTilesInRectangle(this.viewPosition.x+this.viewWidth-b,this.viewPosition.y,b,this.viewHeight),c=$jscomp.makeIterator(g),g=c.next();!g.done;g=c.next())this.rerenderTile(g.value);if(0>b)for(b=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,-1*b,this.viewHeight),b=$jscomp.makeIterator(b),g=b.next();!g.done;g=b.next())this.rerenderTile(g.value);if(0<a)for(b=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y+this.viewHeight-a,this.viewWidth,
a),b=$jscomp.makeIterator(b),g=b.next();!g.done;g=b.next())this.rerenderTile(g.value);if(0>a)for(a=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,-1*a),a=$jscomp.makeIterator(a),g=a.next();!g.done;g=a.next())this.rerenderTile(g.value)};p.prototype.handleClick=function(b){b=this.world.getTileAtCoordinates(new k(Math.floor(this.viewWidth/this.canvas.clientWidth*(b.pageX-this.canvas.offsetLeft))+this.viewPosition.x,Math.floor(this.viewHeight/this.canvas.clientHeight*
(b.pageY-this.canvas.offsetTop))+this.viewPosition.y));this.selectTile(b)};p.prototype.handleKeyDown=function(b){b=b.code;"ArrowUp"!==b&&"KeyW"!==b||this.moveViewArea(0,-1);"ArrowLeft"!==b&&"KeyA"!==b||this.moveViewArea(-1,0);"ArrowDown"!==b&&"KeyS"!==b||this.moveViewArea(0,1);"ArrowRight"!==b&&"KeyD"!==b||this.moveViewArea(1,0)};p.pixelsPerTile=64;var D=function(b,a){this.parentScreen=b;this.run=a;this.position=null;this.html=c.makeDiv(["world-screen-sidebar"]);this.refresh()};D.prototype.getHTML=
function(){return this.html};D.prototype.changeTile=function(b){this.position=b;this.refresh()};D.prototype.refresh=function(){if(null==this.position)c.fillHTML(this.html,[c.makePara("No structure or terrain tile selected")]);else{var b=this.run.world.getTileAtCoordinates(this.position),a=c.makeDiv();b.populationCapacity&&a.appendChild(c.makePara("Population capacity for "+b.populationCapacity.capacity+" "+b.populationCapacity.species.name));var d=c.makeDiv();if(0<b.possibleProjects.length){d.appendChild(c.makePara("Projects:"));
for(var e=$jscomp.makeIterator(b.possibleProjects),f=e.next();!f.done;f=e.next())d.appendChild(this.makeProjectHTML(b,f.value))}e=c.makeDiv();if(0<b.resourceConversions.length){e.appendChild(c.makePara("Production:"));f=$jscomp.makeIterator(b.resourceConversions);for(var h=f.next();!h.done;h=f.next())e.appendChild(this.makeConversionHTML(h.value))}c.fillHTML(this.html,[c.makePara(b.getTileName()),c.makePara("Coordinates: "+this.position.x+", "+this.position.y),a,d,e])}};D.prototype.makeProjectHTML=
function(b,a){var g=this,d=c.makeDiv(),e=!a.canDo(b.position,this.run);e=c.makeButton(a.title,function(){g.doProject(a,b)},[],e);d.appendChild(e);0==a.costs.length?d.appendChild(c.makePara("Cost: Free")):(e="Cost: "+a.costs.map(function(b){return""+b.toString()}).join(", "),d.appendChild(c.makePara(e)));0<a.completionRequirements.length&&(e=a.completionRequirements.map(function(b){return"- "+b.toString()+"\n"}).join(""),d.appendChild(c.makePara("Requirements:\n"+e)));return d};D.prototype.makeConversionHTML=
function(b){return c.makePara("- "+b.toString())};D.prototype.doProject=function(b,a){b.doAction(a.position,this.run);this.run.updateQuestState();this.parentScreen.refreshComponents()};var U=function(b){this.inventory=b.inventory;this.html=c.makeDiv(["world-screen-inventory"]);this.refresh()};U.prototype.getHTML=function(){return this.html};U.prototype.refresh=function(){for(var b=c.makeHeader("Population: "+this.inventory.getTotalPopulation(),1),a=c.makePara("Available workers: "+this.inventory.getAvailableWorkers()),
d=c.makeDiv(),e=$jscomp.makeIterator(this.inventory.getPopulationStrings()),f=e.next();!f.done;f=e.next())d.appendChild(c.makePara(f.value));e=c.makeDiv();var h=$jscomp.makeIterator(this.inventory.getInventoryStrings());for(f=h.next();!f.done;f=h.next())e.appendChild(c.makePara(f.value));c.fillHTML(this.html,[c.makeDivContaining([b,a,d,c.makeHeader("Inventory:",1),e])])};var L=function(b){this.html=c.makeDiv(["world-screen-header"]);this.run=b;this.refresh()};L.prototype.refresh=function(){var b=
this,a=c.makeButton("Quit Game",function(){r.showMainMenu()}),d=c.makeButton("Next Turn",function(){r.transitionToNextTurn()}),e=c.makeButton("Manage Production",function(){r.showProductionScreen()}),f=this.run.getCurrentQuestHint(),h=this.run.getCurrentQuestDescription();f=c.makePara("Objective: "+(f?h+"\n(hint: "+f+")":h),["world-screen-quest-description"]);h=this.run.getPreviousQuestDescription();this.run.questCompletionShown||(f=c.makePara("Completed: "+h,["world-screen-quest-description","quest-description-emphasis"]),
setTimeout(function(){b.refresh()},1500));this.run.questCompletionShown=!0;c.fillHTML(this.html,[a,e,d,f])};L.prototype.getHTML=function(){return this.html};var M=function(b){this.mapUI=new p(this,b.world);this.tileSidebar=new D(this,b);var a=this.mapUI.getViewCanvas();this.inventorySidebar=new U(b);var d=this.tileSidebar.getHTML(),e=this.inventorySidebar.getHTML();this.header=new L(b);this.worldScreenHTML=c.makeDivContaining([this.header.getHTML(),c.makeDivContaining([e,c.makeDivContaining([a],["world-screen-map-box"]),
d],["world-screen-hbox"])],["flex-vertical"])};M.prototype.getHTML=function(){return this.worldScreenHTML};M.prototype.refreshComponents=function(){this.mapUI.refreshViewableArea();this.tileSidebar.refresh();this.inventorySidebar.refresh();this.header.refresh()};M.prototype.handleKeyDown=function(b){this.mapUI.handleKeyDown(b)};M.prototype.changeSidebarTile=function(b){this.tileSidebar.changeTile(b)};var Q=function(){};Q.generate=function(b,a){for(var g=Array(b),c=0;c<b;c++)g[c]=a();return g};Q.flatten=
function(b){return b.reduce(function(b,a){b=void 0===b?[]:b;return b.concat(a)})};var t=function(b){this.position=b;this.possibleProjects=[];this.resourceConversions=[];this.populationCapacity=void 0},F=function(b,a,c,d){this.title=b;this.action=a;this.costs=c;this.completionRequirements=d};F.prototype.canDo=function(b,a){return a.inventory.canAfford(this.costs)&&this.completionRequirements.every(function(g){return g.evaluate(a,b)})};F.prototype.doAction=function(b,a){if(!this.canDo(b,a))throw"tried to do project "+
this.title+" without meeting requirments";a.inventory.payCost(this.costs);this.action(b,a)};var w=function(b,a){this.name=b;this.growthMultiplier=a};w.values=function(){return Object.keys(w).map(function(b){return w[b]})};w.Human=new w("Human Colonists",.1);w.Robot=new w("Robotic Platform",1);var Y=function(b,a){this.species=b;this.capacity=a},u=function(b){b=t.call(this,b)||this;b.populationCapacity=new Y(w.Human,200);return b};$jscomp.inherits(u,t);u.prototype.getImgSrc=function(){return"assets/tiles/habitat.png"};
u.prototype.getTileName=function(){return u.tileName};u.tileName="Habitat Dome";var v=function(b,a){this.resource=b;this.quantity=a};v.prototype.toString=function(){return this.resource.name+" x"+this.quantity};var l=function(b){this.name=b};l.values=function(){return Object.keys(l).map(function(b){return l[b]})};l.Energy=new l("Energy");l.Metal=new l("Metal Ore");l.BuildingMaterials=new l("Construction Materials");l.Electronics=new l("Electronics");var N=function(b,a){this.radius=b;this.targetType=
a;return this};$jscomp.inherits(N,function(){});N.prototype.evaluate=function(b,a){var g=this;return 0<b.world.getTilesInCircle(a,this.radius).filter(function(b){return b instanceof g.targetType}).length};N.prototype.toString=function(){return 1==this.radius?"adjacent to a "+this.targetType.tileName:"within "+this.radius+" units of a "+this.targetType.tileName};var A=function(b,a,c){this.inputs=b;this.outputs=a;this.enabled=!0;this.requiredWorkers=c||0;this.isFree()?this.priority=0:(this.priority=
A.nextNumber,A.nextNumber++)};A.prototype.toString=function(){var b=this.outputs.map(function(b){return b.toString()}).join(", "),a="Produce "+b;0<this.inputs.length&&(a="Convert "+this.inputs.map(function(b){return b.toString()}).join(", ")+" into "+b);0!=this.requiredWorkers&&(a+=" using "+this.requiredWorkers+" workers");return a};A.prototype.isFree=function(){return 0==this.inputs.length&&!this.requiredWorkers};A.nextNumber=1;var G=function(b){b=t.call(this,b)||this;b.resourceConversions=[new A([new v(l.Metal,
100)],[new v(l.BuildingMaterials,100)],60),new A([new v(l.Metal,100)],[new v(l.Electronics,100)],30)];return b};$jscomp.inherits(G,t);G.prototype.getImgSrc=function(){return"assets/tiles/mining_facility.png"};G.prototype.getTileName=function(){return G.tileName};G.tileName="Ore Processing Center";var x=function(b){b=t.call(this,b)||this;b.possibleProjects=[new F("Strip Mining",function(b,a){a.inventory.addResource(l.Metal,150);a.world.placeTile(new q(b))},[new v(l.Energy,25)],[])];return b};$jscomp.inherits(x,
t);x.prototype.getImgSrc=function(){return"assets/tiles/mountain.png"};x.prototype.getTileName=function(){return x.tileName};x.tileName="Mountain";var B=function(b){b=t.call(this,b)||this;b.resourceConversions=[new A([],[new v(l.Energy,100)])];return b};$jscomp.inherits(B,t);B.prototype.getImgSrc=function(){return"assets/tiles/solar_panels.png"};B.prototype.getTileName=function(){return B.tileName};B.tileName="Photovoltaic Array";var q=function(b){b=t.call(this,b)||this;b.possibleProjects=[new F("Construct habitat dome",
function(b,a){a.world.placeTile(new u(b))},[new v(l.BuildingMaterials,100)],[new N(1,u)]),new F("Construct ore processing center",function(b,a){a.world.placeTile(new G(b))},[new v(l.Energy,200),new v(l.Metal,300)],[new N(5,x)]),new F("Construct photovoltaic array",function(b,a){a.world.placeTile(new B(b))},[new v(l.Electronics,200)],[])];return b};$jscomp.inherits(q,t);q.prototype.getImgSrc=function(){return"assets/tiles/wasteland.png"};q.prototype.getTileName=function(){return q.tileName};q.tileName=
"Wasteland";var H=function(){};H.realBetween=function(b,a){return Math.random()*(a-b)+b};H.intBetween=function(b,a){return Math.floor(H.realBetween(b,a))};H.fromArray=function(b){return b[H.intBetween(0,b.length)]};var I=function(b){this.width=b.worldWidth;this.height=b.worldHeight;this.grid=Array(this.height);for(var a=0;a<this.height;a++){this.grid[a]=Array(this.width);for(var c=0;c<this.width;c++)this.grid[a][c]=new q(new k(c,a))}a=H.intBetween(b.minMountains,b.maxMountains);for(c=0;c<a;c++){var d=
this.getTiles().filter(function(b){return b instanceof q});d=H.fromArray(d).position;this.placeTile(new x(d))}b=$jscomp.makeIterator(b.nonrandomTiles);for(a=b.next();!a.done;a=b.next())this.placeTile(a.value)};I.prototype.placeTile=function(b){this.grid[b.position.y][b.position.x]=b};I.prototype.getTiles=function(){return Q.flatten(this.grid)};I.prototype.getTilesInRectangle=function(b,a,c,d){0>a&&(a=0);0>b&&(b=0);var g=[];a=this.grid.slice(a,a+d);a=$jscomp.makeIterator(a);for(d=a.next();!d.done;d=
a.next()){d=d.value.slice(b,b+c);d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())g.push(e.value)}return g};I.prototype.getTileAtCoordinates=function(b){return this.grid[b.y][b.x]};I.prototype.getTilesInCircle=function(b,a){return this.getTiles().filter(function(c){return b.distanceFrom(c.position)<=a})};I.prototype.getPopulationCapacity=function(b){for(var a=0,c=$jscomp.makeIterator(this.getTiles()),d=c.next();!d.done;d=c.next())d=d.value,d.populationCapacity&&d.populationCapacity.species==
b&&(a+=d.populationCapacity.capacity);return a};var y=function(){this.map=new Map([])};y.prototype.add=function(b,a){this.set(b,this.get(b)+a)};y.prototype.remove=function(b,a){this.add(b,-1*a)};y.prototype.get=function(b){return this.map.get(b)||0};y.prototype.set=function(b,a){if(0>a)throw"tried to set quantity to negative value";0==a?this.map.delete(b):this.map.set(b,a)};y.prototype.getSum=function(){return Array.from(this.map.values()).reduce(function(b,a){return b+a},0)};y.prototype.positiveQuantityKeys=
function(){return Array.from(this.map.keys())};y.prototype.clone=function(){for(var b=new y,a=$jscomp.makeIterator(this.positiveQuantityKeys()),c=a.next();!c.done;c=a.next())c=c.value,b.add(c,this.get(c));return b};var n=function(a){this.world=a;this.resourceQuantities=new y;this.populationQuantities=new y;this.availableWorkers=0};n.prototype.addResource=function(a,c){this.resourceQuantities.add(a,c)};n.prototype.removeResource=function(a,c){this.resourceQuantities.remove(a,c)};n.prototype.getResourceQuantity=
function(a){return this.resourceQuantities.get(a)||0};n.prototype.addWorkers=function(a,c){this.populationQuantities.add(a,c);this.populationQuantities.set(a,e(0,this.populationQuantities.get(a),this.world.getPopulationCapacity(a)))};n.prototype.releaseWorkers=function(){this.availableWorkers=this.populationQuantities.getSum()};n.prototype.occupyWorkers=function(a){if(this.availableWorkers<a)throw"insufficient workers";if(0>a)throw"tried to occupy a negative number of workers";this.availableWorkers-=
a};n.prototype.doPopulationGrowth=function(){for(var a=$jscomp.makeIterator(this.populationQuantities.positiveQuantityKeys()),c=a.next();!c.done;c=a.next()){c=c.value;var d=Math.floor(c.growthMultiplier*this.populationQuantities.get(c));this.addWorkers(c,d)}};n.prototype.getTotalPopulation=function(){return this.populationQuantities.getSum()};n.prototype.getAvailableWorkers=function(){return this.availableWorkers};n.prototype.canAfford=function(a){var b=this,c=new Map;a=$jscomp.makeIterator(a);for(var d=
a.next();!d.done;d=a.next())d=d.value,c.set(d.resource,d.quantity+(c.get(d.resource)||0));return Array.from(c.keys()).every(function(a){var d=c.get(a);a=b.getResourceQuantity(a);return d<=a})};n.prototype.hasEnoughWorkers=function(a){return this.availableWorkers>=a};n.prototype.payCost=function(a){if(this.canAfford(a)){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,this.removeResource(b.resource,b.quantity)}else throw"Cannot afford to pay cost";};n.prototype.getResourceList=
function(){return this.resourceQuantities.positiveQuantityKeys()};n.prototype.getInventoryStrings=function(){var a=this;return this.getResourceList().map(function(b){return b.name+": "+a.getResourceQuantity(b)})};n.prototype.getPopulationStrings=function(){var a=this;return this.populationQuantities.positiveQuantityKeys().map(function(b){return a.populationQuantities.get(b)+" "+b.name})};n.prototype.applyConversions=function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(b=
b.value,this.canAfford(b.inputs)&&this.hasEnoughWorkers(b.requiredWorkers)&&b.enabled){this.payCost(b.inputs);this.occupyWorkers(b.requiredWorkers);b=$jscomp.makeIterator(b.outputs);for(var c=b.next();!c.done;c=b.next())c=c.value,this.addResource(c.resource,c.quantity)}};n.prototype.clone=function(){var a=new n(this.world);a.resourceQuantities=this.resourceQuantities.clone();a.populationQuantities=this.populationQuantities.clone();a.availableWorkers=this.availableWorkers;return a};var J=function(a){a=
t.call(this,a)||this;a.possibleProjects=[new F("Unpack Lander",function(a,b){var c=b.world;c.placeTile(new u(new k(a.x+1,a.y)));c.placeTile(new G(new k(a.x,a.y-1)));c.placeTile(new B(new k(a.x+1,a.y-1)));c.placeTile(new q(a));b.inventory.addWorkers(w.Human,100)},[],[])];return a};$jscomp.inherits(J,t);J.prototype.getImgSrc=function(){return"assets/tiles/lander.png"};J.prototype.getTileName=function(){return J.tileName};J.tileName="Landing Pod";var V=function(a,c,d,e,f){this.nonrandomTiles=a;this.worldWidth=
c;this.worldHeight=d;this.minMountains=e;this.maxMountains=f};V.standardWorldParameters=function(){var a=[new x(new k(0,0)),new x(new k(1,0)),new x(new k(2,0)),new q(new k(0,1)),new q(new k(1,1)),new q(new k(2,1)),new q(new k(0,2)),new J(new k(1,2)),new q(new k(2,2)),new q(new k(0,3)),new q(new k(1,3)),new q(new k(2,4))];return new V(a,20,20,20,25)};a=function(a,c){this.requirement=a;this.nextStage=c};d=function(a,c,d,e){this.description=a;this.hint=c;this.paths=d;this.isWinState=void 0===e?!1:e};
d.prototype.updatedStage=function(a){for(var b=$jscomp.makeIterator(this.paths),c=b.next();!c.done;c=b.next())if(c=c.value,c.requirement.evaluate(a))return c.nextStage().updatedStage(a);return this};f=function(){};var O=function(a,c){this.resource=a;this.minQuantity=c;return this};$jscomp.inherits(O,f);O.prototype.evaluate=function(a){return a.inventory.getResourceQuantity(this.resource)>=this.minQuantity};O.prototype.toString=function(){return"have at least "+this.minQuantity+" units of "+this.resource.name+
" in inventory"};var R=function(a,c){this.tileType=a;this.minQuantity=c;return this};$jscomp.inherits(R,f);R.prototype.evaluate=function(a){var b=this;return a.world.getTiles().filter(function(a){return a instanceof b.tileType}).length>=this.minQuantity};R.prototype.toString=function(){return"have at least "+this.minQuantity+"  "+this.tileType.tileName+" tile"+(1==this.minQuantity?"":"s")};var S=function(a){this.minimumPopulation=a;return this};$jscomp.inherits(S,f);S.prototype.evaluate=function(a){return a.inventory.getTotalPopulation()>=
this.minimumPopulation};S.prototype.toString=function(){return"have a total population of at least "+this.minimumPopulation};var aa=new d("Deploy shelter for the colonists","select the "+J.tileName,[new a(new R(u,1),function(){return Z})]),Z=new d("Build up at least 100 units of "+l.Energy.name,"the "+B.tileName+" produces "+l.Energy.name+" each turn",[new a(new O(l.Energy,100),function(){return ba})]),ba=new d("Acquire "+l.Metal.name,void 0,[new a(new O(l.Metal,1),function(){return ca})]),ca=new d("Grow total worker population to 250",
"A "+u.tileName+" has capacity for "+(new u(new k(0,0))).populationCapacity.capacity+" colonists",[new a(new S(250),function(){return da})]),da=new d("[no current objective]",void 0,[]),z=function(){this.turnNumber=1;this.prevQuestDescription="";this.questCompletionShown=!0;this.world=new I(V.standardWorldParameters());this.inventory=new n(this.world);this.questStage=aa};z.prototype.getCurrentQuestDescription=function(){return this.questStage.description};z.prototype.getCurrentQuestHint=function(){return this.questStage.hint};
z.prototype.getPreviousQuestDescription=function(){return this.prevQuestDescription};z.prototype.getResourceConversions=function(){var a=Q.flatten(this.world.getTiles().map(function(a){return a.resourceConversions}));a.sort(function(a,b){return a.priority-b.priority});return a};z.prototype.updateQuestState=function(){var a=this.questStage.updatedStage(this);a!=this.questStage&&(this.prevQuestDescription=this.questStage.description,this.questCompletionShown=!1,this.questStage=a)};z.prototype.completeTurn=
function(){this.inventory.applyConversions(this.getResourceConversions());this.inventory.releaseWorkers();this.inventory.doPopulationGrowth();this.turnNumber++;this.updateQuestState()};z.prototype.increaseConversionPriority=function(a){if(0!=a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&0!=c&&(b=b[c-1],0!=b.priority&&(c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value))}};z.prototype.decreaseConversionPriority=function(a){if(0!=
a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&c!=b.length-1&&(b=b[c+1],c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value)}};var P=function(a,c){this.currentGame=a;this.worldScreen=c};P.prototype.refresh=function(){this.currentGame.updateQuestState();this.worldScreen.refreshComponents()};P.prototype.addResource=function(a,c){this.currentGame.inventory.addResource(a,c);this.refresh()};P.prototype.addPopulation=function(a,c){this.currentGame.inventory.addWorkers(a,
c);this.refresh()};var T=function(){this.html=c.makeDiv();c.fillHTML(this.html,[c.makePara("Loading...")])};T.prototype.getHTML=function(){return this.html};T.prototype.revealButton=function(){c.fillHTML(this.html,[c.makeButton("Continue",this.continueToNextTurn)])};T.prototype.continueToNextTurn=function(){r.showWorldScreen()};var C=function(a){this.run=a;this.html=c.makeDiv(["production-screen"]);this.refresh()};C.prototype.refresh=function(){var a=this,d=this.run.inventory.clone(),e=this.run.getResourceConversions().filter(function(a){return a.isFree()}),
f=e.map(function(b){return a.renderConversion(b,!0,!1)});d.applyConversions(e);var h=this.run.getResourceConversions().filter(function(a){return!a.isFree()});e=[];h=$jscomp.makeIterator(h);for(var k=h.next();!k.done;k=h.next())k=k.value,d.canAfford(k.inputs)&&d.hasEnoughWorkers(k.requiredWorkers)?(e.push(this.renderConversion(k,!0,!0)),d.applyConversions([k])):e.push(this.renderConversion(k,!1,!0));c.fillHTML(this.html,[c.makePara("Resource Production Report",["production-screen-label"]),c.makePara("Available workers at start of next production cycle: "+
this.run.inventory.getAvailableWorkers(),["production-screen-label"]),c.makePara("Resources available at start of next production cycle:",["production-screen-label"]),this.renderInventory(this.run.inventory),c.makePara("Resource generation in next production cycle:",["production-screen-label"]),c.makeDivContaining(f),c.makePara("Resource conversion in next production cycle:",["production-screen-label"]),c.makeDivContaining(e),c.makePara("Unused workers at end of next production cycle: "+d.getAvailableWorkers(),
["production-screen-label"]),c.makePara("Resources available at end of next production cycle:",["production-screen-label"]),this.renderInventory(d),c.makeButton("Back",function(){r.showWorldScreen()},["production-screen-back-button"])])};C.prototype.getHTML=function(){return this.html};C.prototype.renderInventory=function(a){a=a.getInventoryStrings().map(function(a){return c.makePara(a)});0==a.length&&a.push(c.makePara("(none)"));return c.makeDivContaining(a,["production-screen-inventory"])};C.prototype.renderConversion=
function(a,d,e){var b=this,f=c.makeDiv(["flex-horizontal"]),g=a.toString(),h="conversion-description-normal";a.enabled?d||(g="(cannot afford) "+a.toString(),h="conversion-description-cannot-afford"):(g="(disabled) "+a.toString(),h="conversion-description-disabled");f.appendChild(c.makeButton(g,function(){b.toggle(a)},[h,"conversion-description"]));e&&(f.appendChild(c.makeButton("Move Up",function(){return b.moveConversionUp(a)})),f.appendChild(c.makeButton("Move Down",function(){return b.moveConversionDown(a)})));
return f};C.prototype.moveConversionUp=function(a){this.run.increaseConversionPriority(a);this.refresh()};C.prototype.moveConversionDown=function(a){this.run.decreaseConversionPriority(a);this.refresh()};C.prototype.toggle=function(a){a.enabled=!a.enabled;this.refresh()};a=function(a,c){this.name=a;this.roles=c};var W=[new a("Grace Rarer",["Team Lead","Gameplay Programmer"]),new a("Prindle",["DevOps"]),new a("May Lawver",["Programmer (HTML Composition Code)"])],X=function(){};X.render=function(){var a=
W.map(function(a){return c.makePara(a.name,["credits-name"])}),d=W.map(function(a){return c.makePara(a.roles.join(", "),["credits-roles"])});return c.makeDivContaining([c.makeHeader("Credits",1),c.makeDivContaining([c.makeDivContaining(a,["credits-names-column"]),c.makeDivContaining(d)],["credits-container"]),c.makeButton("Back",function(){return r.showMainMenu()})],["credits"])};var r=function(){};r.showMainMenu=function(){m();c.fillHTML(this.rootDiv,[K.renderMainMenu()])};r.showCredits=function(){m();
c.fillHTML(this.rootDiv,[X.render()])};r.startGame=function(){this.currentRun=new z;this.showWorldScreen()};r.showWorldScreen=function(){var a=new M(this.currentRun);c.fillHTML(this.rootDiv,[a.getHTML()]);h(this.currentRun,a);document.onkeydown=function(b){a.handleKeyDown(b)}};r.showProductionScreen=function(){m();var a=new C(this.currentRun);c.fillHTML(this.rootDiv,[a.getHTML()])};r.transitionToNextTurn=function(){m();var a=new T;c.fillHTML(this.rootDiv,[a.getHTML()]);this.currentRun.completeTurn();
a.revealButton()};r.rootDiv=document.getElementById("rootdiv");window.onload=function(){console.log("Script Loaded");r.showMainMenu()}}]);}).call(this || window)
</script><script type="text/javascript">(function(){'use strict';}).call(this || window)
</script></body> </html> 