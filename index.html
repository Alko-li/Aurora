<!doctype html> <html lang=en dir=ltr> <head> <meta charset=utf-8> <title>Aurora</title> <style type="text/css">.main-menu{display:flex;flex-direction:column}.main-menu h1{font-size:40pt;margin:0;padding:0}.main-menu-options button{display:flex;flex-direction:column}.main-menu button{font-size:24pt;border:none;margin:0;padding:0}.main-menu button:hover{font-size:30pt}.main-menu button:active{color:grey}.credits h1{font-size:24pt;margin-bottom:10pt}.credits-container{display:flex;flex-direction:row}.credits-names-column{margin-right:24pt}.credits-name{font-size:20pt;margin-top:0;margin-bottom:5pt}.credits-roles{font-size:20pt;margin-top:0;margin-bottom:0}.credits button{margin-top:10pt;font-size:20pt}.world-screen-header{display:flex;flex-direction:row;margin:0;min-height:60px}.world-screen-quest-description{font-size:16px;padding-right:10px;padding-top:0;padding-bottom:0}.quest-description-emphasis{color:#408040;font-weight:700}.world-screen-hbox{margin:0;display:flex;flex-direction:row}.world-screen-map-box{height:100%;width:100%}.map-canvas{width:100%;margin:0}.world-screen-sidebar{background-color:#000;width:20%;margin:20px;font-size:16px}.world-screen-inventory{width:20%;margin:10px;font-size:16px}.production-screen{padding-left:10pt}.production-screen-label{font-size:20pt}.production-screen-inventory{font-size:16pt;line-height:0;padding:1pt;outline:solid #fff;width:50%}.conversion-description{font-size:16pt;width:50%;text-align:left}.conversion-description-normal{color:#fff}.conversion-description-cannot-afford{color:tomato}.conversion-description-disabled{color:#ff0}.production-screen-back-button{font-size:20pt;margin-top:20pt}:root,button{background-color:#000;color:#fff;font-family:monospace}button{font-size:18px}button:focus{outline:0}button:disabled,button[disabled]{color:grey;border-color:grey}.flex-horizontal{display:flex;flex-direction:row}.flex-vertical{display:flex;flex-direction:column}.fill-horizontal{width:100%;font-family:serif}.fill-vertical{height:100%}</style></head> <body> <div id=rootdiv> <p>Loading scripts...</p> </div> <script type="text/javascript">(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,f){a!=Array.prototype&&a!=Object.prototype&&(a[d]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,d){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(f){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+d++,f)}var d=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var d,f=[];!(d=a.next()).done;)f.push(d.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var d=function(){};d.prototype=a;return new d};
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},d={};try{return d.__proto__=a,d.a}catch(f){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,d){a.__proto__=d;if(a.__proto__!==d)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,d){a.prototype=$jscomp.objectCreate(d.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var f=$jscomp.setPrototypeOf;f(a,d)}else for(f in d)if("prototype"!=f)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(d,f);e&&Object.defineProperty(a,f,e)}else a[f]=d[f];a.superClass_=d.prototype};
$jscomp.polyfill=function(a,d,f,e){if(d){f=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];c in f||(f[c]={});f=f[c]}a=a[a.length-1];e=f[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Math.hypot",function(a){return a?a:function(a){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var d,e,c;for(d=c=0;d<arguments.length;d++)c=Math.max(c,Math.abs(arguments[d]));if(1e+100<c||1e-100>c){if(!c)return c;for(d=e=0;d<arguments.length;d++){var q=Number(arguments[d])/c;e+=q*q}return Math.sqrt(e)*c}for(d=e=0;d<arguments.length;d++)q=Number(arguments[d]),e+=q*q;return Math.sqrt(e)}},"es6","es3");
$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,e={next:function(){if(f<a.length){var c=f++;return{value:d(c,a[c]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},d=Object.create(new $jscomp.global.Proxy(a,{get:function(f,e,c){return f==a&&"q"==e&&c==d}}));return!0===d.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};
$jscomp.polyfill("WeakMap",function(a){function d(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),d=Object.seal({}),e=new a([[c,2],[d,3]]);if(2!=e.get(c)||3!=e.get(d))return!1;e.delete(c);e.set(d,4);return!e.has(c)&&4==e.get(d)}catch(J){return!1}}function f(){}function e(c){var a=typeof c;return"object"===a&&null!==c||"function"===a}function c(c){if(!$jscomp.owns(c,h)){var a=new f;$jscomp.defineProperty(c,h,{value:a})}}function q(a){var d=Object[a];d&&(Object[a]=function(a){if(a instanceof
f)return a;c(a);return d(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(d())return a;var h="$jscomp_hidden_"+Math.random();q("freeze");q("preventExtensions");q("seal");var l=0,r=function(c){this.id_=(l+=Math.random()+1).toString();if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};r.prototype.set=function(a,d){if(!e(a))throw Error("Invalid WeakMap key");c(a);if(!$jscomp.owns(a,h))throw Error("WeakMap key fail: "+
a);a[h][this.id_]=d;return this};r.prototype.get=function(c){return e(c)&&$jscomp.owns(c,h)?c[h][this.id_]:void 0};r.prototype.has=function(c){return e(c)&&$jscomp.owns(c,h)&&$jscomp.owns(c[h],this.id_)};r.prototype.delete=function(c){return e(c)&&$jscomp.owns(c,h)&&$jscomp.owns(c[h],this.id_)?delete c[h][this.id_]:!1};return r},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function d(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),d=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=d.get(c)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=c||"s"!=f.value[1])return!1;f=e.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!e.next().done?!1:!0}catch(J){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(d())return a;$jscomp.initSymbolIterator();var f=new WeakMap,e=function(c){this.data_={};this.head_=h();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};e.prototype.set=function(a,d){a=0===a?0:a;var e=c(this,a);e.list||(e.list=this.data_[e.id]=[]);e.entry?e.entry.value=d:(e.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:d},e.list.push(e.entry),this.head_.previous.next=e.entry,this.head_.previous=e.entry,this.size++);return this};e.prototype.delete=function(a){a=c(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=h();this.size=0};e.prototype.has=function(a){return!!c(this,a).entry};
e.prototype.get=function(a){return(a=c(this,a).entry)&&a.value};e.prototype.entries=function(){return q(this,function(c){return[c.key,c.value]})};e.prototype.keys=function(){return q(this,function(c){return c.key})};e.prototype.values=function(){return q(this,function(c){return c.value})};e.prototype.forEach=function(c,a){for(var d=this.entries(),e;!(e=d.next()).done;)e=e.value,c.call(a,e[1],e[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var c=function(c,a){var d=a&&typeof a;"object"==
d||"function"==d?f.has(a)?d=f.get(a):(d=""+ ++l,f.set(a,d)):d="p_"+a;var e=c.data_[d];if(e&&$jscomp.owns(c.data_,d))for(c=0;c<e.length;c++){var h=e[c];if(a!==a&&h.key!==h.key||a===h.key)return{id:d,list:e,index:c,entry:h}}return{id:d,list:e,index:-1,entry:void 0}},q=function(c,a){var d=c.head_;return $jscomp.iteratorPrototype(function(){if(d){for(;d.head!=c.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:a(d)};d=null}return{done:!0,value:void 0}})},h=function(){var c={};return c.previous=
c.next=c.head=c},l=0;return e},"es6","es3");$jscomp.polyfill("Array.from",function(a){return a?a:function(a,f,e){f=null!=f?f:function(c){return c};var c=[],d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof d){a=d.call(a);for(var h=0;!(d=a.next()).done;)c.push(f.call(e,d.value,h++))}else for(d=a.length,h=0;h<d;h++)c.push(f.call(e,a[h],h));return c}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,f){return f})}},"es8","es3");
(function(a){function d(e){if(f[e])return f[e].exports;var c=f[e]={i:e,l:!1,exports:{}};a[e].call(c.exports,c,c.exports,d);c.l=!0;return c.exports}var f={};d.m=a;d.c=f;d.d=function(a,c,f){d.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:f})};d.r=function(a){$jscomp.initSymbol();$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};d.t=function(a,
c){c&1&&(a=d(a));if(c&8||c&4&&"object"===typeof a&&a&&a.__esModule)return a;var e=Object.create(null);d.r(e);Object.defineProperty(e,"default",{enumerable:!0,value:a});if(c&2&&"string"!=typeof a)for(var f in a)d.d(e,f,function(c){return a[c]}.bind(null,f));return e};d.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};d.d(c,"a",c);return c};d.o=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};d.p="";return d(d.s=1)})([,function(a,d,f){function e(b,
g,a){return Math.max(Math.min(g,a),b)}f.r(d);var c=function(){};c.makeDiv=function(b){var g=document.createElement("div");b&&g.classList.add.apply(g.classList,$jscomp.arrayFromIterable(b));return g};c.makeDivContaining=function(b,g){g=this.makeDiv(g);b=$jscomp.makeIterator(b);for(var a=b.next();!a.done;a=b.next())g.appendChild(a.value);return g};c.makeElement=function(b,g,a){b=document.createElement(b);b.innerText=g;a&&b.classList.add.apply(b.classList,$jscomp.arrayFromIterable(a));return b};c.makePara=
function(b,g){return c.makeElement("p",b,g)};c.makeHeader=function(b,g,a){return c.makeElement("h"+(void 0===g?1:g),b,a)};c.makeButton=function(b,g,a,c){c=void 0===c?!1:c;var D=document.createElement("button");D.type="button";D.disabled=c;D.innerText=b;a&&D.classList.add.apply(D.classList,$jscomp.arrayFromIterable(a));D.onclick=function(b){b.preventDefault;g.call(this,b)};return D};c.makeImg=function(b,g){var a=document.createElement("img");a.src=b;g&&a.classList.add.apply(a.classList,$jscomp.arrayFromIterable(g));
return a};c.makeCanvas=function(b,g,a){var c=document.createElement("canvas");c.width=b;c.height=g;a&&c.classList.add.apply(c.classList,$jscomp.arrayFromIterable(a));return c};c.fillHTML=function(b,g){b.innerHTML="";g=$jscomp.makeIterator(g);for(var a=g.next();!a.done;a=g.next())b.appendChild(a.value)};var q=function(){};q.renderMainMenu=function(){return c.makeDivContaining([c.makeHeader("Aurora",1),c.makeDivContaining([c.makeButton("start_game",function(){return n.startGame()}),c.makeButton("display_credits",
function(){return n.showCredits()})],["main-menu-options"])],["main-menu"])};var h=function(b,g){this.x=b;this.y=g};h.prototype.toString=function(){return"("+this.x+", "+this.y+")"};h.prototype.distanceFrom=function(b){return Math.hypot(Math.abs(this.x-b.x),Math.abs(this.y-b.y))};var l=function(b,g){var a=this;this.viewWidth=12;this.viewHeight=8;this.viewPosition=new h(0,0);this.highlightedCoordinates=null;this.world=g;this.parentScreen=b;this.canvas=c.makeCanvas(this.viewWidth*l.pixelsPerTile,this.viewHeight*
l.pixelsPerTile,["map-canvas"]);this.canvas.addEventListener("click",function(b){return a.handleClick(b)});this.refreshViewableArea()};l.prototype.getViewCanvas=function(){return this.canvas};l.prototype.refreshViewableArea=function(){var b=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,this.viewHeight);b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;g=b.next())this.rerenderTile(g.value)};l.prototype.drawSquareAtCoordinates=function(b,g){var a=this.canvas.getContext("2d");
a.imageSmoothingEnabled=!1;var c=new Image,d=g.x-this.viewPosition.x,e=g.y-this.viewPosition.y;0>d||0>e||d>=this.viewWidth||e>=this.viewHeight||(c.onload=function(){a.drawImage(c,d*l.pixelsPerTile,e*l.pixelsPerTile,l.pixelsPerTile,l.pixelsPerTile)},c.src=b)};l.prototype.rerenderTile=function(b){this.drawSquareAtCoordinates(b.getImgSrc(),b.position);b.position===this.highlightedCoordinates&&this.drawSquareAtCoordinates("assets/ui/highlight.png",b.position)};l.prototype.selectTile=function(b){if(!b||
b.position!==this.highlightedCoordinates){if(this.highlightedCoordinates){var g=this.world.getTileAtCoordinates(this.highlightedCoordinates);this.highlightedCoordinates=null;this.rerenderTile(g)}b?(this.drawSquareAtCoordinates("assets/ui/highlight.png",b.position),this.highlightedCoordinates=b.position):this.highlightedCoordinates=null;this.parentScreen.changeSidebarTile(this.highlightedCoordinates)}};l.prototype.moveViewArea=function(b,g){var a=this.viewPosition.x,c=this.viewPosition.y;b=e(0,this.viewPosition.x+
b,this.world.width-this.viewWidth);g=e(0,this.viewPosition.y+g,this.world.height-this.viewHeight);this.viewPosition=new h(b,g);b=this.viewPosition.x-a;g=this.viewPosition.y-c;a=b*l.pixelsPerTile*-1;c=g*l.pixelsPerTile*-1;this.canvas.getContext("2d").drawImage(this.canvas,a,c);if(0<b)for(a=this.world.getTilesInRectangle(this.viewPosition.x+this.viewWidth-b,this.viewPosition.y,b,this.viewHeight),c=$jscomp.makeIterator(a),a=c.next();!a.done;a=c.next())this.rerenderTile(a.value);if(0>b)for(b=this.world.getTilesInRectangle(this.viewPosition.x,
this.viewPosition.y,-1*b,this.viewHeight),b=$jscomp.makeIterator(b),a=b.next();!a.done;a=b.next())this.rerenderTile(a.value);if(0<g)for(b=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y+this.viewHeight-g,this.viewWidth,g),b=$jscomp.makeIterator(b),a=b.next();!a.done;a=b.next())this.rerenderTile(a.value);if(0>g)for(g=this.world.getTilesInRectangle(this.viewPosition.x,this.viewPosition.y,this.viewWidth,-1*g),g=$jscomp.makeIterator(g),a=g.next();!a.done;a=g.next())this.rerenderTile(a.value)};
l.prototype.handleClick=function(b){b=this.world.getTileAtCoordinates(new h(Math.floor(this.viewWidth/this.canvas.clientWidth*(b.pageX-this.canvas.offsetLeft))+this.viewPosition.x,Math.floor(this.viewHeight/this.canvas.clientHeight*(b.pageY-this.canvas.offsetTop))+this.viewPosition.y));this.selectTile(b)};l.prototype.handleKeyDown=function(b){b=b.code;"ArrowUp"!==b&&"KeyW"!==b||this.moveViewArea(0,-1);"ArrowLeft"!==b&&"KeyA"!==b||this.moveViewArea(-1,0);"ArrowDown"!==b&&"KeyS"!==b||this.moveViewArea(0,
1);"ArrowRight"!==b&&"KeyD"!==b||this.moveViewArea(1,0)};l.pixelsPerTile=64;var r=function(b,a){this.parentScreen=b;this.run=a;this.position=null;this.html=c.makeDiv(["world-screen-sidebar"]);this.refresh()};r.prototype.getHTML=function(){return this.html};r.prototype.changeTile=function(b){this.position=b;this.refresh()};r.prototype.refresh=function(){if(null==this.position)c.fillHTML(this.html,[c.makePara("No structure or terrain tile selected")]);else{var b=this.run.world.getTileAtCoordinates(this.position),
a=c.makeDiv();b.populationCapacity&&a.appendChild(c.makePara("Population capacity for "+b.populationCapacity.capacity+" "+b.populationCapacity.species.name));var d=c.makeDiv();if(0<b.possibleProjects.length){d.appendChild(c.makePara("Projects:"));for(var e=$jscomp.makeIterator(b.possibleProjects),f=e.next();!f.done;f=e.next())d.appendChild(this.makeProjectHTML(b,f.value))}e=c.makeDiv();if(0<b.resourceConversions.length){e.appendChild(c.makePara("Production:"));f=$jscomp.makeIterator(b.resourceConversions);
for(var h=f.next();!h.done;h=f.next())e.appendChild(this.makeConversionHTML(h.value))}c.fillHTML(this.html,[c.makePara(b.getTileName()),c.makePara("Coordinates: "+this.position.x+", "+this.position.y),a,d,e])}};r.prototype.makeProjectHTML=function(b,a){var g=this,d=c.makeDiv(),e=!a.canDo(b.position,this.run);e=c.makeButton(a.title,function(){g.doProject(a,b)},[],e);d.appendChild(e);0==a.costs.length?d.appendChild(c.makePara("Cost: Free")):(e="Cost: "+a.costs.map(function(b){return""+b.toString()}).join(", "),
d.appendChild(c.makePara(e)));0<a.completionRequirements.length&&(e=a.completionRequirements.map(function(b){return"- "+b.toString()+"\n"}).join(""),d.appendChild(c.makePara("Requirements:\n"+e)));return d};r.prototype.makeConversionHTML=function(b){return c.makePara("- "+b.toString())};r.prototype.doProject=function(b,a){b.doAction(a.position,this.run);this.run.updateQuestState();this.parentScreen.refreshComponents()};var P=function(b){this.inventory=b.inventory;this.html=c.makeDiv(["world-screen-inventory"]);
this.refresh()};P.prototype.getHTML=function(){return this.html};P.prototype.refresh=function(){for(var b=c.makeHeader("Population: "+this.inventory.getTotalPopulation(),1),a=c.makePara("Available workers: "+this.inventory.getAvailableWorkers()),d=c.makeDiv(),e=$jscomp.makeIterator(this.inventory.getPopulationStrings()),f=e.next();!f.done;f=e.next())d.appendChild(c.makePara(f.value));e=c.makeDiv();var h=$jscomp.makeIterator(this.inventory.getInventoryStrings());for(f=h.next();!f.done;f=h.next())e.appendChild(c.makePara(f.value));
c.fillHTML(this.html,[c.makeDivContaining([b,a,d,c.makeHeader("Inventory:",1),e])])};var Q=function(b){this.html=c.makeDiv(["world-screen-header"]);this.run=b;this.refresh()};Q.prototype.refresh=function(){var b=this,a=c.makeButton("Quit Game",function(){n.showMainMenu()}),d=c.makeButton("Next Turn",function(){n.transitionToNextTurn()}),e=c.makeButton("Manage Production",function(){n.showProductionScreen()}),f=this.run.getCurrentQuestHint(),h=this.run.getCurrentQuestDescription();f=c.makePara("Objective: "+
(f?h+"\n(hint: "+f+")":h),["world-screen-quest-description"]);h=this.run.getPreviousQuestDescription();this.run.questCompletionShown||(f=c.makePara("Completed: "+h,["world-screen-quest-description","quest-description-emphasis"]),setTimeout(function(){b.refresh()},1500));this.run.questCompletionShown=!0;c.fillHTML(this.html,[a,e,d,f])};Q.prototype.getHTML=function(){return this.html};var K=function(b){this.mapUI=new l(this,b.world);this.tileSidebar=new r(this,b);var a=this.mapUI.getViewCanvas();this.inventorySidebar=
new P(b);var d=this.tileSidebar.getHTML(),e=this.inventorySidebar.getHTML();this.header=new Q(b);this.worldScreenHTML=c.makeDivContaining([this.header.getHTML(),c.makeDivContaining([e,c.makeDivContaining([a],["world-screen-map-box"]),d],["world-screen-hbox"])],["flex-vertical"])};K.prototype.getHTML=function(){return this.worldScreenHTML};K.prototype.refreshComponents=function(){this.mapUI.refreshViewableArea();this.tileSidebar.refresh();this.inventorySidebar.refresh();this.header.refresh()};K.prototype.handleKeyDown=
function(b){this.mapUI.handleKeyDown(b)};K.prototype.changeSidebarTile=function(b){this.tileSidebar.changeTile(b)};var J=function(){};J.generate=function(b,a){for(var g=Array(b),c=0;c<b;c++)g[c]=a();return g};J.flatten=function(b){return b.reduce(function(b,a){b=void 0===b?[]:b;return b.concat(a)})};var t=function(b){this.position=b;this.possibleProjects=[];this.resourceConversions=[];this.populationCapacity=void 0},E=function(b,a,c,d){this.title=b;this.action=a;this.costs=c;this.completionRequirements=
d};E.prototype.canDo=function(b,a){return a.inventory.canAfford(this.costs)&&this.completionRequirements.every(function(g){return g.evaluate(a,b)})};E.prototype.doAction=function(b,a){if(!this.canDo(b,a))throw"tried to do project "+this.title+" without meeting requirments";a.inventory.payCost(this.costs);this.action(b,a)};var x=function(b,a){this.name=b;this.growthMultiplier=a};x.values=function(){return Object.keys(x).map(function(b){return x[b]})};x.Human=new x("Human Colonists",.1);x.Robot=new x("Robotic Platform",
1);var V=function(b,a){this.species=b;this.capacity=a},y=function(b){b=t.call(this,b)||this;b.populationCapacity=new V(x.Human,200);return b};$jscomp.inherits(y,t);y.prototype.getImgSrc=function(){return"assets/tiles/habitat.png"};y.prototype.getTileName=function(){return y.tileName};y.tileName="Habitat Dome";var u=function(b,a){this.resource=b;this.quantity=a};u.prototype.toString=function(){return this.resource.name+" x"+this.quantity};var k=function(b){this.name=b};k.values=function(){return Object.keys(k).map(function(b){return k[b]})};
k.Energy=new k("Energy");k.Metal=new k("Metal Ore");k.BuildingMaterials=new k("Construction Materials");k.Electronics=new k("Electronics");var L=function(b,a){this.radius=b;this.targetType=a;return this};$jscomp.inherits(L,function(){});L.prototype.evaluate=function(b,a){var c=this;return 0<b.world.getTilesInCircle(a,this.radius).filter(function(b){return b instanceof c.targetType}).length};L.prototype.toString=function(){return 1==this.radius?"adjacent to a "+this.targetType.tileName:"within "+this.radius+
" units of a "+this.targetType.tileName};var A=function(b,a,c){this.inputs=b;this.outputs=a;this.enabled=!0;this.requiredWorkers=c||0;this.isFree()?this.priority=0:(this.priority=A.nextNumber,A.nextNumber++)};A.prototype.toString=function(){var b=this.outputs.map(function(b){return b.toString()}).join(", "),a="Produce "+b;0<this.inputs.length&&(a="Convert "+this.inputs.map(function(b){return b.toString()}).join(", ")+" into "+b);0!=this.requiredWorkers&&(a+=" using "+this.requiredWorkers+" workers");
return a};A.prototype.isFree=function(){return 0==this.inputs.length&&!this.requiredWorkers};A.nextNumber=1;var F=function(b){b=t.call(this,b)||this;b.resourceConversions=[new A([new u(k.Metal,100)],[new u(k.BuildingMaterials,100)],60),new A([new u(k.Metal,100)],[new u(k.Electronics,100)],30)];return b};$jscomp.inherits(F,t);F.prototype.getImgSrc=function(){return"assets/tiles/mining_facility.png"};F.prototype.getTileName=function(){return F.tileName};F.tileName="Ore Processing Center";var v=function(b){b=
t.call(this,b)||this;b.possibleProjects=[new E("Strip Mining",function(b,a){a.inventory.addResource(k.Metal,150);a.world.placeTile(new p(b))},[new u(k.Energy,25)],[])];return b};$jscomp.inherits(v,t);v.prototype.getImgSrc=function(){return"assets/tiles/mountain.png"};v.prototype.getTileName=function(){return v.tileName};v.tileName="Mountain";var B=function(b){b=t.call(this,b)||this;b.resourceConversions=[new A([],[new u(k.Energy,100)])];return b};$jscomp.inherits(B,t);B.prototype.getImgSrc=function(){return"assets/tiles/solar_panels.png"};
B.prototype.getTileName=function(){return B.tileName};B.tileName="Photovoltaic Array";var p=function(b){b=t.call(this,b)||this;b.possibleProjects=[new E("Construct habitat dome",function(b,a){a.world.placeTile(new y(b))},[new u(k.BuildingMaterials,100)],[new L(1,y)]),new E("Construct ore processing center",function(b,a){a.world.placeTile(new F(b))},[new u(k.Energy,200),new u(k.Metal,300)],[new L(5,v)]),new E("Construct photovoltaic array",function(b,a){a.world.placeTile(new B(b))},[new u(k.Electronics,
200)],[])];return b};$jscomp.inherits(p,t);p.prototype.getImgSrc=function(){return"assets/tiles/wasteland.png"};p.prototype.getTileName=function(){return p.tileName};p.tileName="Wasteland";var G=function(){};G.realBetween=function(b,a){return Math.random()*(a-b)+b};G.intBetween=function(b,a){return Math.floor(G.realBetween(b,a))};G.fromArray=function(b){return b[G.intBetween(0,b.length)]};var H=function(b){this.width=b.worldWidth;this.height=b.worldHeight;this.grid=Array(this.height);for(var a=0;a<
this.height;a++){this.grid[a]=Array(this.width);for(var c=0;c<this.width;c++)this.grid[a][c]=new p(new h(c,a))}a=G.intBetween(b.minMountains,b.maxMountains);for(c=0;c<a;c++){var d=this.getTiles().filter(function(b){return b instanceof p});d=G.fromArray(d).position;this.placeTile(new v(d))}b=$jscomp.makeIterator(b.nonrandomTiles);for(a=b.next();!a.done;a=b.next())this.placeTile(a.value)};H.prototype.placeTile=function(b){this.grid[b.position.y][b.position.x]=b};H.prototype.getTiles=function(){return J.flatten(this.grid)};
H.prototype.getTilesInRectangle=function(b,a,c,d){0>a&&(a=0);0>b&&(b=0);var g=[];a=this.grid.slice(a,a+d);a=$jscomp.makeIterator(a);for(d=a.next();!d.done;d=a.next()){d=d.value.slice(b,b+c);d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())g.push(e.value)}return g};H.prototype.getTileAtCoordinates=function(b){return this.grid[b.y][b.x]};H.prototype.getTilesInCircle=function(b,a){return this.getTiles().filter(function(c){return b.distanceFrom(c.position)<=a})};H.prototype.getPopulationCapacity=
function(b){for(var a=0,c=$jscomp.makeIterator(this.getTiles()),d=c.next();!d.done;d=c.next())d=d.value,d.populationCapacity&&d.populationCapacity.species==b&&(a+=d.populationCapacity.capacity);return a};var w=function(){this.map=new Map([])};w.prototype.add=function(b,a){this.set(b,this.get(b)+a)};w.prototype.remove=function(b,a){this.add(b,-1*a)};w.prototype.get=function(b){return this.map.get(b)||0};w.prototype.set=function(b,a){if(0>a)throw"tried to set quantity to negative value";0==a?this.map.delete(b):
this.map.set(b,a)};w.prototype.getSum=function(){return Array.from(this.map.values()).reduce(function(b,a){return b+a},0)};w.prototype.positiveQuantityKeys=function(){return Array.from(this.map.keys())};w.prototype.clone=function(){for(var b=new w,a=$jscomp.makeIterator(this.positiveQuantityKeys()),c=a.next();!c.done;c=a.next())c=c.value,b.add(c,this.get(c));return b};var m=function(b){this.world=b;this.resourceQuantities=new w;this.populationQuantities=new w;this.availableWorkers=0};m.prototype.addResource=
function(b,a){this.resourceQuantities.add(b,a)};m.prototype.removeResource=function(b,a){this.resourceQuantities.remove(b,a)};m.prototype.getResourceQuantity=function(b){return this.resourceQuantities.get(b)||0};m.prototype.addWorkers=function(b,a){this.populationQuantities.add(b,a);this.populationQuantities.set(b,e(0,this.populationQuantities.get(b),this.world.getPopulationCapacity(b)))};m.prototype.releaseWorkers=function(){this.availableWorkers=this.populationQuantities.getSum()};m.prototype.occupyWorkers=
function(b){if(this.availableWorkers<b)throw"insufficient workers";if(0>b)throw"tried to occupy a negative number of workers";this.availableWorkers-=b};m.prototype.doPopulationGrowth=function(){for(var b=$jscomp.makeIterator(this.populationQuantities.positiveQuantityKeys()),a=b.next();!a.done;a=b.next()){a=a.value;var c=Math.floor(a.growthMultiplier*this.populationQuantities.get(a));this.addWorkers(a,c)}};m.prototype.getTotalPopulation=function(){return this.populationQuantities.getSum()};m.prototype.getAvailableWorkers=
function(){return this.availableWorkers};m.prototype.canAfford=function(b){var a=this,c=new Map;b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())d=d.value,c.set(d.resource,d.quantity+(c.get(d.resource)||0));return Array.from(c.keys()).every(function(b){var d=c.get(b);b=a.getResourceQuantity(b);return d<=b})};m.prototype.hasEnoughWorkers=function(b){return this.availableWorkers>=b};m.prototype.payCost=function(b){if(this.canAfford(b)){b=$jscomp.makeIterator(b);for(var a=b.next();!a.done;a=
b.next())a=a.value,this.removeResource(a.resource,a.quantity)}else throw"Cannot afford to pay cost";};m.prototype.getResourceList=function(){return this.resourceQuantities.positiveQuantityKeys()};m.prototype.getInventoryStrings=function(){var b=this;return this.getResourceList().map(function(a){return a.name+": "+b.getResourceQuantity(a)})};m.prototype.getPopulationStrings=function(){var b=this;return this.populationQuantities.positiveQuantityKeys().map(function(a){return b.populationQuantities.get(a)+
" "+a.name})};m.prototype.applyConversions=function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(b=b.value,this.canAfford(b.inputs)&&this.hasEnoughWorkers(b.requiredWorkers)&&b.enabled){this.payCost(b.inputs);this.occupyWorkers(b.requiredWorkers);b=$jscomp.makeIterator(b.outputs);for(var c=b.next();!c.done;c=b.next())c=c.value,this.addResource(c.resource,c.quantity)}};m.prototype.clone=function(){var b=new m(this.world);b.resourceQuantities=this.resourceQuantities.clone();
b.populationQuantities=this.populationQuantities.clone();b.availableWorkers=this.availableWorkers;return b};var I=function(b){b=t.call(this,b)||this;b.possibleProjects=[new E("Unpack Lander",function(b,a){var c=a.world;c.placeTile(new y(new h(b.x+1,b.y)));c.placeTile(new F(new h(b.x,b.y-1)));c.placeTile(new B(new h(b.x+1,b.y-1)));c.placeTile(new p(b));a.inventory.addWorkers(x.Human,100)},[],[])];return b};$jscomp.inherits(I,t);I.prototype.getImgSrc=function(){return"assets/tiles/lander.png"};I.prototype.getTileName=
function(){return I.tileName};I.tileName="Landing Pod";var R=function(b,a,c,d,e){this.nonrandomTiles=b;this.worldWidth=a;this.worldHeight=c;this.minMountains=d;this.maxMountains=e};R.standardWorldParameters=function(){var b=[new v(new h(0,0)),new v(new h(1,0)),new v(new h(2,0)),new p(new h(0,1)),new p(new h(1,1)),new p(new h(2,1)),new p(new h(0,2)),new I(new h(1,2)),new p(new h(2,2)),new p(new h(0,3)),new p(new h(1,3)),new p(new h(2,4))];return new R(b,20,20,20,25)};a=function(b,a){this.requirement=
b;this.nextStage=a};d=function(b,a,c,d){this.description=b;this.hint=a;this.paths=c;this.isWinState=void 0===d?!1:d};d.prototype.updatedStage=function(b){for(var a=$jscomp.makeIterator(this.paths),c=a.next();!c.done;c=a.next())if(c=c.value,c.requirement.evaluate(b))return c.nextStage().updatedStage(b);return this};f=function(){};var M=function(a,c){this.resource=a;this.minQuantity=c;return this};$jscomp.inherits(M,f);M.prototype.evaluate=function(a){return a.inventory.getResourceQuantity(this.resource)>=
this.minQuantity};M.prototype.toString=function(){return"have at least "+this.minQuantity+" units of "+this.resource.name+" in inventory"};var N=function(a,c){this.tileType=a;this.minQuantity=c;return this};$jscomp.inherits(N,f);N.prototype.evaluate=function(a){var b=this;return a.world.getTiles().filter(function(a){return a instanceof b.tileType}).length>=this.minQuantity};N.prototype.toString=function(){return"have at least "+this.minQuantity+"  "+this.tileType.tileName+" tile"+(1==this.minQuantity?
"":"s")};var X=new d("Deploy shelter for the colonists","select the "+I.tileName,[new a(new N(y,1),function(){return W})]),W=new d("Build up at least 100 units of "+k.Energy.name,"the "+B.tileName+" produces "+k.Energy.name+" each turn",[new a(new M(k.Energy,100),function(){return Y})]),Y=new d("Acquire "+k.Metal.name,void 0,[new a(new M(k.Metal,1),function(){return Z})]),Z=new d("[no current objective]",void 0,[]),z=function(){this.turnNumber=1;this.prevQuestDescription="";this.questCompletionShown=
!0;this.world=new H(R.standardWorldParameters());this.inventory=new m(this.world);this.questStage=X};z.prototype.getCurrentQuestDescription=function(){return this.questStage.description};z.prototype.getCurrentQuestHint=function(){return this.questStage.hint};z.prototype.getPreviousQuestDescription=function(){return this.prevQuestDescription};z.prototype.getResourceConversions=function(){var a=J.flatten(this.world.getTiles().map(function(a){return a.resourceConversions}));a.sort(function(a,b){return a.priority-
b.priority});return a};z.prototype.updateQuestState=function(){var a=this.questStage.updatedStage(this);a!=this.questStage&&(this.prevQuestDescription=this.questStage.description,this.questCompletionShown=!1,this.questStage=a)};z.prototype.completeTurn=function(){this.inventory.applyConversions(this.getResourceConversions());this.inventory.releaseWorkers();this.inventory.doPopulationGrowth();this.turnNumber++;this.updateQuestState()};z.prototype.increaseConversionPriority=function(a){if(0!=a.priority){var b=
this.getResourceConversions(),c=b.indexOf(a);-1!=c&&0!=c&&(b=b[c-1],0!=b.priority&&(c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value))}};z.prototype.decreaseConversionPriority=function(a){if(0!=a.priority){var b=this.getResourceConversions(),c=b.indexOf(a);-1!=c&&c!=b.length-1&&(b=b[c+1],c=$jscomp.makeIterator([b.priority,a.priority]),a.priority=c.next().value,b.priority=c.next().value)}};var S=function(a,c){this.currentGame=a;this.worldScreen=c};
S.prototype.addResource=function(a,c){this.currentGame.inventory.addResource(a,c);this.currentGame.updateQuestState();this.worldScreen.refreshComponents()};var O=function(){this.html=c.makeDiv();c.fillHTML(this.html,[c.makePara("Loading...")])};O.prototype.getHTML=function(){return this.html};O.prototype.revealButton=function(){c.fillHTML(this.html,[c.makeButton("Continue",this.continueToNextTurn)])};O.prototype.continueToNextTurn=function(){n.showWorldScreen()};var C=function(a){this.run=a;this.html=
c.makeDiv(["production-screen"]);this.refresh()};C.prototype.refresh=function(){var a=this,d=this.run.inventory.clone(),e=this.run.getResourceConversions().filter(function(a){return a.isFree()}),f=e.map(function(b){return a.renderConversion(b,!0,!1)});d.applyConversions(e);var h=this.run.getResourceConversions().filter(function(a){return!a.isFree()});e=[];h=$jscomp.makeIterator(h);for(var k=h.next();!k.done;k=h.next())k=k.value,d.canAfford(k.inputs)&&d.hasEnoughWorkers(k.requiredWorkers)?(e.push(this.renderConversion(k,
!0,!0)),d.applyConversions([k])):e.push(this.renderConversion(k,!1,!0));c.fillHTML(this.html,[c.makePara("Resource Production Report",["production-screen-label"]),c.makePara("Available workers at start of next production cycle: "+this.run.inventory.getAvailableWorkers(),["production-screen-label"]),c.makePara("Resources available at start of next production cycle:",["production-screen-label"]),this.renderInventory(this.run.inventory),c.makePara("Resource generation in next production cycle:",["production-screen-label"]),
c.makeDivContaining(f),c.makePara("Resource conversion in next production cycle:",["production-screen-label"]),c.makeDivContaining(e),c.makePara("Unused workers at end of next production cycle: "+d.getAvailableWorkers(),["production-screen-label"]),c.makePara("Resources available at end of next production cycle:",["production-screen-label"]),this.renderInventory(d),c.makeButton("Back",function(){n.showWorldScreen()},["production-screen-back-button"])])};C.prototype.getHTML=function(){return this.html};
C.prototype.renderInventory=function(a){a=a.getInventoryStrings().map(function(a){return c.makePara(a)});0==a.length&&a.push(c.makePara("(none)"));return c.makeDivContaining(a,["production-screen-inventory"])};C.prototype.renderConversion=function(a,d,e){var b=this,f=c.makeDiv(["flex-horizontal"]),g=a.toString(),h="conversion-description-normal";a.enabled?d||(g="(cannot afford) "+a.toString(),h="conversion-description-cannot-afford"):(g="(disabled) "+a.toString(),h="conversion-description-disabled");
f.appendChild(c.makeButton(g,function(){b.toggle(a)},[h,"conversion-description"]));e&&(f.appendChild(c.makeButton("Move Up",function(){return b.moveConversionUp(a)})),f.appendChild(c.makeButton("Move Down",function(){return b.moveConversionDown(a)})));return f};C.prototype.moveConversionUp=function(a){this.run.increaseConversionPriority(a);this.refresh()};C.prototype.moveConversionDown=function(a){this.run.decreaseConversionPriority(a);this.refresh()};C.prototype.toggle=function(a){a.enabled=!a.enabled;
this.refresh()};a=function(a,c){this.name=a;this.roles=c};var T=[new a("Grace Rarer",["Team Lead","Gameplay Programmer"]),new a("Prindle",["Tooling Programmer"])],U=function(){};U.render=function(){var a=T.map(function(a){return c.makePara(a.name,["credits-name"])}),d=T.map(function(a){return c.makePara(a.roles.join(", "),["credits-roles"])});return c.makeDivContaining([c.makeHeader("Credits",1),c.makeDivContaining([c.makeDivContaining(a,["credits-names-column"]),c.makeDivContaining(d)],["credits-container"]),
c.makeButton("Back",function(){return n.showMainMenu()})],["credits"])};var n=function(){};n.showMainMenu=function(){this.disableCheats();c.fillHTML(this.rootDiv,[q.renderMainMenu()])};n.showCredits=function(){this.disableCheats();c.fillHTML(this.rootDiv,[U.render()])};n.startGame=function(){this.currentRun=new z;this.showWorldScreen()};n.showWorldScreen=function(){var a=new K(this.currentRun);c.fillHTML(this.rootDiv,[a.getHTML()]);this.enableCheats(a);document.onkeydown=function(b){a.handleKeyDown(b)}};
n.showProductionScreen=function(){this.disableCheats();var a=new C(this.currentRun);c.fillHTML(this.rootDiv,[a.getHTML()])};n.transitionToNextTurn=function(){this.disableCheats();var a=new O;c.fillHTML(this.rootDiv,[a.getHTML()]);this.currentRun.completeTurn();a.revealButton()};n.enableCheats=function(a){window.cheats=new S(this.currentRun,a);window.Resources=k};n.disableCheats=function(){window.cheats=void 0;window.Resources=void 0};n.rootDiv=document.getElementById("rootdiv");window.onload=function(){console.log("Script Loaded");
n.showMainMenu()}}]);}).call(this || window)
</script><script type="text/javascript">(function(){'use strict';}).call(this || window)
</script></body> </html> 